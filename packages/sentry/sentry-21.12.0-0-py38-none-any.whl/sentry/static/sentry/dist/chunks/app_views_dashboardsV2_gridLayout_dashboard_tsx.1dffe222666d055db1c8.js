"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_dashboardsV2_gridLayout_dashboard_tsx"],{"./app/actionCreators/events.tsx":(e,t,s)=>{s.d(t,{lI:()=>d,eV:()=>l,JE:()=>p}),s("../node_modules/core-js/modules/es.object.from-entries.js"),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var o=s("../node_modules/lodash/pick.js"),i=s.n(o),r=s("./app/components/charts/utils.tsx"),a=s("./app/utils/getPeriod.tsx"),n=s("./app/utils/performance/constants.tsx");const d=(e,{organization:t,project:s,environment:o,team:i,period:n,start:d,end:l,interval:p,comparisonDelta:c,includePrevious:u,query:h,yAxis:m,field:g,topEvents:b,orderby:y,partial:v,withoutZerofill:x,referrer:Z,queryBatching:w})=>{const f=(0,r.Sw)(u,n),C={query:{...Object.fromEntries(Object.entries({interval:p,comparisonDelta:c,project:s,environment:o,team:i,query:h,yAxis:m,field:g,topEvents:b,orderby:y,partial:v?"1":void 0,withoutZerofill:x?"1":void 0,referrer:Z||"api.organization-event-stats"}).filter((([,e])=>void 0!==e))),...(0,a.X)({period:n,start:d,end:l},{shouldDoublePeriod:f})}},_="/organizations/".concat(t.slug,"/events-stats/");return null!=w&&w.batchRequest?w.batchRequest(e,_,C):e.requestPromise(_,C)};async function l(e,t,s){const o={...i()(s,Object.values(n.s)),query:s.query};return e.requestPromise("/organizations/".concat(t,"/events-facets/"),{query:o})}async function p(e,t,s){const o={...i()(s,Object.values(n.s)),query:s.query};return e.requestPromise("/organizations/".concat(t,"/events-meta/"),{query:o}).then((e=>e.count))}},"./app/components/charts/areaChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>d});var o=s("../node_modules/react/index.js"),i=s("./app/components/charts/series/lineSeries.tsx"),r=s("./app/components/charts/baseChart.tsx"),a=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class n extends o.Component{render(){const{series:e,stacked:t,colors:s,...o}=this.props;return(0,a.tZ)(r.Z,{...o,colors:s,series:e.map((({seriesName:e,data:o,...r},a)=>function(e={}){return(0,i.Z)({...e})}({stack:t?"area":void 0,name:e,data:o.map((({name:e,value:t})=>[e,t])),lineStyle:{color:null==s?void 0:s[a],opacity:1,width:.4},areaStyle:{color:null==s?void 0:s[a],opacity:1},animation:!1,animationThreshold:1,animationDuration:0,...r})))})}}n.displayName="AreaChart";const d=n},"./app/components/charts/chartZoom.tsx":(e,t,s)=>{s.d(t,{Z:()=>g});var o=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=s("../node_modules/react/index.js"),r=s("../node_modules/moment/moment.js"),a=s.n(r),n=s("../node_modules/query-string/index.js"),d=s("./app/actionCreators/globalSelection.tsx"),l=s("./app/components/charts/components/dataZoomInside.tsx"),p=s("./app/components/charts/components/toolBox.tsx"),c=s("./app/utils/callIfFunction.tsx"),u=s("./app/utils/dates.tsx");const h=e=>e?a().utc(e).format(a().HTML5_FMT.DATETIME_LOCAL_SECONDS):null;class m extends i.Component{constructor(e){super(e),(0,o.Z)(this,"history",void 0),(0,o.Z)(this,"currentPeriod",void 0),(0,o.Z)(this,"zooming",null),(0,o.Z)(this,"saveCurrentPeriod",(e=>{this.currentPeriod={period:e.period,start:h(e.start),end:h(e.end)}})),(0,o.Z)(this,"setPeriod",(({period:e,start:t,end:s},o=!1)=>{const{router:i,onZoom:r,usePageDate:a}=this.props,l=h(t),p=h(s);o&&this.history.push(this.currentPeriod),(0,c.g)(r,{period:e,start:l,end:p}),this.zooming=()=>{if(a&&i){const o={...i.location.query,pageStart:t?(0,u.v5)(t):void 0,pageEnd:s?(0,u.v5)(s):void 0,pageStatsPeriod:null!=e?e:void 0};n.stringify(o)!==n.stringify(i.location.query)&&i.push({pathname:i.location.pathname,query:o})}else(0,d.dR)({period:e,start:l?(0,u.hC)(l):l,end:p?(0,u.hC)(p):p},i);this.saveCurrentPeriod({period:e,start:t,end:s})}})),(0,o.Z)(this,"handleChartReady",(e=>{(0,c.g)(this.props.onChartReady,e)})),(0,o.Z)(this,"handleZoomRestore",((e,t)=>{this.history.length&&(this.setPeriod(this.history[0]),this.history=[],(0,c.g)(this.props.onRestore,e,t))})),(0,o.Z)(this,"handleDataZoom",((e,t)=>{const s=t.getModel(),{startValue:o,endValue:i}=s._payload.batch[0];if(null===o&&null===i){const e=this.history.pop();if(!e)return;this.setPeriod(e)}else{const e=a().utc(o),t=a().utc(i);this.setPeriod({period:null,start:e,end:t},!0)}(0,c.g)(this.props.onDataZoom,e,t)})),(0,o.Z)(this,"handleChartFinished",((e,t)=>{var s;"function"==typeof this.zooming&&(this.zooming(),this.zooming=null);const o=null===(s=t._componentsViews)||void 0===s?void 0:s.find((e=>e._features&&e._features.dataZoom));o&&!o._features.dataZoom._isZoomActive&&t.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:!0}),(0,c.g)(this.props.onFinished)})),this.history=[],this.saveCurrentPeriod(e)}componentDidUpdate(){this.props.disabled||this.saveCurrentPeriod(this.props)}render(){const{utc:e,start:t,end:s,disabled:o,children:i,xAxisIndex:r,router:a,onZoom:n,onRestore:d,onChartReady:c,onDataZoom:h,onFinished:m,...g}=this.props,b=null!=e?e:void 0,y=t?(0,u.hC)(t):void 0,v=s?(0,u.hC)(s):void 0;return i(o?{utc:b,start:y,end:v,...g}:{isGroupedByDate:!0,onChartReady:this.handleChartReady,utc:b,start:y,end:v,dataZoom:(0,l.Z)({xAxisIndex:r}),showTimeInTooltip:!0,toolBox:(0,p.Z)({},{dataZoom:{title:{zoom:"",back:""},iconStyle:{borderWidth:0,color:"transparent",opacity:0}}}),onDataZoom:this.handleDataZoom,onFinished:this.handleChartFinished,onRestore:this.handleZoomRestore,...g})}}m.displayName="ChartZoom";const g=m},"./app/components/charts/components/visualMap.tsx":(e,t,s)=>{function o(e){return e}s.d(t,{Z:()=>o}),s("../node_modules/echarts/lib/component/visualMap.js")},"./app/components/charts/lineChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>n});var o=s("../node_modules/react/index.js"),i=s("./app/components/charts/series/lineSeries.tsx"),r=s("./app/components/charts/baseChart.tsx"),a=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class n extends o.Component{render(){const{series:e,seriesOptions:t,...s}=this.props;return(0,a.tZ)(r.Z,{...s,series:e.map((({seriesName:e,data:s,dataArray:o,...r})=>(0,i.Z)({...t,...r,name:e,data:o||(null==s?void 0:s.map((({value:e,name:t})=>[t,e]))),animation:!1,animationThreshold:1,animationDuration:0})))})}}n.displayName="LineChart"},"./app/components/charts/simpleTableChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>b});var o=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/react/index.js"),r=s("./app/components/panels/panelTable.tsx"),a=s("./app/styles/space.tsx"),n=s("./app/utils/discover/fieldRenderers.tsx"),d=s("./app/utils/discover/fields.tsx"),l=s("./app/utils/withOrganization.tsx"),p=s("./app/views/eventsV2/utils.tsx"),c=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class u extends i.Component{renderRow(e,t,s,o){const{location:i,organization:r}=this.props;return o.map((o=>{const a=(0,n.Js)(o.name,s)(t,{organization:r,location:i});return(0,c.tZ)(g,{children:a},"".concat(e,":").concat(o.name))}))}render(){const{className:e,loading:t,fields:s,metadata:o,data:r,title:a}=this.props,n=null!=o?o:{},l=(0,p.Hg)(s.map((e=>({field:e}))));return(0,c.BX)(i.Fragment,{children:[a&&(0,c.tZ)("h4",{children:a}),(0,c.tZ)(h,{className:e,isLoading:t,headers:l.map(((e,t)=>{const s=(0,d.qG)(e.name,e.type,n);return(0,c.tZ)(m,{align:s,children:e.name},t)})),isEmpty:!(null!=r&&r.length),disablePadding:!0,children:null==r?void 0:r.map(((e,t)=>this.renderRow(t,e,n,l)))})]})}}u.displayName="SimpleTableChart";const h=(0,o.Z)(r.Z,{target:"e3tr8vk2"})("border-radius:0;border-left:0;border-right:0;border-bottom:0;margin:0;",r.z,"{height:min-content;}"),m=(0,o.Z)("div",{target:"e3tr8vk1"})((e=>e.align?"text-align: ".concat(e.align,";"):"")," padding:",(0,a.Z)(1)," ",(0,a.Z)(3),";"),g=(0,o.Z)("div",{target:"e3tr8vk0"})("padding:",(0,a.Z)(1)," ",(0,a.Z)(3),";"),b=(0,l.Z)(u)},"./app/components/charts/transitionChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>d});var o=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),r=s("./app/components/charts/loadingPanel.tsx"),a=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class n extends i.Component{constructor(...e){super(...e),(0,o.Z)(this,"state",{prevReloading:this.props.reloading,prevLoading:this.props.loading,key:1})}static getDerivedStateFromProps(e,t){const s=t.prevReloading,o=e.reloading,i=t.prevLoading,r=e.loading;return i!==r?{prevReloading:o,prevLoading:r,key:t.key+1}:r?{prevReloading:o,prevLoading:r,key:t.key}:s&&!o?{prevReloading:o,prevLoading:r,key:t.key+1}:{prevReloading:o,prevLoading:r,key:t.key}}render(){const{height:e,loading:t,reloading:s}=this.props;return t&&!s?(0,a.tZ)(r.Z,{height:e,"data-test-id":"events-request-loading"}):(0,a.tZ)(i.Fragment,{children:this.props.children},String(this.state.key))}}n.displayName="TransitionChart",(0,o.Z)(n,"defaultProps",{height:"200px"});const d=n},"./app/components/charts/transparentLoadingMask.tsx":(e,t,s)=>{s.d(t,{Z:()=>a});var o=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(s("../node_modules/react/index.js"),s("./app/components/loadingMask.tsx")),r=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const a=(0,o.Z)((({className:e,visible:t,children:s,...o})=>{const a=t?{...o,"data-test-id":"loading-placeholder"}:o;return(0,r.tZ)(i.Z,{className:e,...a,children:s})}),{target:"ewtkxp50"})((e=>!e.visible&&"display: none;"),";opacity:0.4;z-index:1;")},"./app/components/charts/worldMapChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>m});var o=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.object.from-entries.js"),s("../node_modules/react/index.js")),r=s("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),a=s("../node_modules/echarts/lib/core/echarts.js"),n=s("../node_modules/lodash/max.js"),d=s.n(n),l=s("./app/components/charts/components/visualMap.tsx");s("../node_modules/echarts/lib/chart/map.js");var p=s("./app/components/charts/baseChart.tsx"),c=s("./app/components/charts/utils.tsx"),u=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class h extends i.Component{constructor(...e){super(...e),(0,o.Z)(this,"state",{countryToCodeMap:null,map:null,codeToCountryMap:null})}async componentDidMount(){const[e,t]=await Promise.all([s.e("app_data_countryCodesMap_tsx").then(s.bind(s,"./app/data/countryCodesMap.tsx")),s.e("app_data_world_json").then(s.t.bind(s,"./app/data/world.json",19))]);a.je("sentryWorld",t.default),this.setState({countryToCodeMap:e.default,map:t.default,codeToCountryMap:Object.fromEntries(Object.entries(e.default).map((([e,t])=>[t,e])))})}render(){const{countryToCodeMap:e,map:t}=this.state;if(null===e||null===t)return null;const{series:s,seriesOptions:o,theme:i,fromDiscover:r,fromDiscoverQueryList:a,...n}=this.props,h=s.map((({seriesName:e,data:t,...s})=>{var n;return function(e={map:""}){return{roam:!0,itemStyle:{emphasis:{label:{show:!1}}},...e,type:"map"}}({...o,...s,map:"sentryWorld",name:e,nameMap:null!==(n=this.state.countryToCodeMap)&&void 0!==n?n:void 0,aspectScale:.85,zoom:r?1.1:a?.9:1.3,center:[10.97,a?-12:9.71],itemStyle:{areaColor:i.gray200,borderColor:i.backgroundSecondary},emphasis:{itemStyle:{areaColor:i.pink300},label:{show:!1}},data:t,silent:a,roam:!a})})),m=d()(s.map((({data:e})=>d()(e.map((({value:e})=>e))))))||1;return(0,u.tZ)(p.Z,{options:{backgroundColor:a?void 0:i.background,visualMap:[(0,l.Z)({show:!a,left:r?void 0:"right",right:r?5:void 0,min:0,max:m,inRange:{color:[i.purple200,i.purple300]},text:["High","Low"],textStyle:{color:i.textColor},calculable:!1})]},...n,yAxis:null,xAxis:null,series:h,tooltip:{formatter:e=>{var t;const{marker:s,name:o,value:i}=Array.isArray(e)?e[0]:e;if(isNaN(i))return"";const r="number"==typeof i?i.toLocaleString():"",a=(null===(t=this.state.codeToCountryMap)||void 0===t?void 0:t[o])||o;return['<div class="tooltip-series tooltip-series-solo">\n                 <div><span class="tooltip-label">'.concat(s," <strong>").concat(a,"</strong></span> ").concat(r,"</div>\n              </div>"),(0,c.U8)()].join("")}},height:r?400:void 0})}}h.displayName="WorldMapChart";const m=(0,r.b)(h)},"./app/utils/discover/charts.tsx":(e,t,s)=>{s.d(t,{CX:()=>n,gu:()=>d});var o=s("./app/locale.tsx"),i=s("./app/utils.tsx"),r=s("./app/utils/discover/fields.tsx"),a=s("./app/utils/formatters.tsx");function n(e,t=""){if(!(0,i.ri)(e))return"—";switch((0,r.Px)(t)){case"integer":case"number":return e.toLocaleString();case"percentage":return(0,a.rl)(e,2);case"duration":return(0,a.g9)(e/1e3,2,!0);default:return e.toString()}}function d(e,t,s=!1){switch((0,r.Px)(t)){case"integer":case"number":return s?(0,a.Du)(e):e.toLocaleString();case"percentage":return(0,a.rl)(e,0);case"duration":return function(e){if(0===e)return"0";if(e>=a.ps){const t=(e/a.ps).toFixed(0);return(0,o.t)("%swk",t)}if(e>=a.x4){const t=(e/a.x4).toFixed(0);return(0,o.t)("%sd",t)}if(e>=a.kr){const t=(e/a.kr).toFixed(0);return(0,o.t)("%shr",t)}if(e>=a.EB){const t=(e/a.EB).toFixed(0);return(0,o.t)("%smin",t)}if(e>=a.sh){const t=(e/a.sh).toFixed(0);return(0,o.t)("%ss",t)}const t=e.toFixed(0);return(0,o.t)("%sms",t)}(e);default:return e.toString()}}},"./app/utils/getPeriod.tsx":(e,t,s)=>{s.d(t,{X:()=>n}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var o=s("../node_modules/moment/moment.js"),i=s.n(o),r=s("./app/constants/index.tsx"),a=s("./app/utils/dates.tsx");const n=({period:e,start:t,end:s},{shouldDoublePeriod:o}={})=>{if(e||t||s||(e=r.GY),e){if(!o)return{statsPeriod:e};const[,t,s]=e.match(/([0-9]+)([mhdw])/);return{statsPeriod:"".concat(2*parseInt(t,10)).concat(s)}}if(!t||!s)throw new Error("start and end required");const n=(0,a.v5)(t),d=(0,a.v5)(s);if(o){const e=i()(s).diff(i()(t)),o=i()(t).subtract(e);return{start:(0,a.v5)(o),end:d}}return{start:n,end:d}}},"./app/views/dashboardsV2/addWidget.tsx":(e,t,s)=>{s.d(t,{g:()=>p,Z:()=>h});var o=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),r=s("./app/components/button.tsx"),a=s("./app/icons/index.tsx"),n=s("./app/views/dashboardsV2/types.tsx"),d=s("./app/views/dashboardsV2/widgetWrapper.tsx"),l=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const p="add-widget-button",c={x:0,y:0,scaleX:1,scaleY:1};function u({onAddWidget:e,onOpenWidgetBuilder:t,orgFeatures:s}){const o=s.includes("metrics")?t:e,{setNodeRef:r,transform:u}=(0,i.nB)({disabled:!0,id:p,transition:null});return(0,l.tZ)(d.Z,{ref:r,displayType:n.FO.BIG_NUMBER,layoutId:p,style:{originX:0,originY:0},animate:u?{x:u.x,y:u.y,scaleX:null!=u&&u.scaleX&&u.scaleX<=1?u.scaleX:1,scaleY:null!=u&&u.scaleY&&u.scaleY<=1?u.scaleY:1}:c,transition:{duration:.25},children:(0,l.tZ)(g,{onClick:o,children:(0,l.tZ)(m,{"data-test-id":"widget-add",icon:(0,l.tZ)(a.N_,{size:"lg",isCircled:!0,color:"inactive"})})})},"add")}u.displayName="AddWidget";const h=u,m=(0,o.Z)(r.ZP,{target:"e1sxcph31"})({name:"6ayxgl",styles:"border:none;&,&:focus,&:active,&:hover{background:transparent;box-shadow:none;}"}),g=(0,o.Z)("div",{target:"e1sxcph30"})("width:100%;height:110px;border:2px dashed ",(e=>e.theme.border),";border-radius:",(e=>e.theme.borderRadius),";display:flex;align-items:center;justify-content:center;cursor:",(e=>e.onClick?"pointer":""),";")},"./app/views/dashboardsV2/gridLayout/dashboard.tsx":(e,t,s)=>{s.d(t,{re:()=>j,TE:()=>z,Yb:()=>A,ZP:()=>T});var o=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react-grid-layout/css/styles.css"),s("../node_modules/react-resizable/css/styles.css"),s("../node_modules/react/index.js")),a=s("../node_modules/react-grid-layout/index.js"),n=s.n(a),d=s("./app/actionCreators/dashboards.tsx"),l=s("./app/actionCreators/indicator.tsx"),p=s("./app/actionCreators/modal.tsx"),c=s("./app/actionCreators/tags.tsx"),u=s("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),h=s("./app/utils/guid.tsx"),m=s("./app/utils/withApi.tsx"),g=s("./app/utils/withGlobalSelection.tsx"),b=s("./app/views/dashboardsV2/addWidget.tsx"),y=s("./app/views/dashboardsV2/types.tsx"),v=s("./app/views/dashboardsV2/widget/utils.tsx"),x=s("./app/views/dashboardsV2/issueWidgetCard.tsx"),Z=s("./app/views/dashboardsV2/widgetCard.tsx"),w=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function f({widget:e,isEditing:t,onDelete:s,onEdit:o}){const i={widget:e,isEditing:t,onDelete:s,onEdit:o,showContextMenu:!0,isSorting:!1,currentWidgetDragging:!1};return(0,w.tZ)(_,{children:e.widgetType===y.l9.ISSUE?(0,w.tZ)(x.Z,{...i}):(0,w.tZ)(Z.Z,{...i})})}f.displayName="SortableWidget";const C=f,_=(0,i.Z)("div",{target:"e90cmjd0"})({name:"13udsys",styles:"height:100%"}),j="widget-drag",R=[16,16],S={x:0,y:Number.MAX_VALUE,w:2,h:1,isResizable:!1};class E extends r.Component{constructor(...e){super(...e),(0,o.Z)(this,"handleStartAdd",(()=>{const{organization:e,dashboard:t,selection:s,handleAddLibraryWidgets:o}=this.props;(0,u.Z)("dashboards_views.add_widget_modal.opened",{organization:e}),e.features.includes("widget-library")?(0,p.openDashboardWidgetLibraryModal)({organization:e,dashboard:t,onAddWidget:e=>o(e)}):(0,p.openAddDashboardWidgetModal)({organization:e,dashboard:t,selection:s,onAddWidget:this.handleAddComplete,source:y.EN.DASHBOARDS})})),(0,o.Z)(this,"handleOpenWidgetBuilder",(()=>{const{router:e,paramDashboardId:t,organization:s,location:o}=this.props;t?e.push({pathname:"/organizations/".concat(s.slug,"/dashboard/").concat(t,"/widget/new/"),query:{...o.query,dataSet:v.qg.EVENTS}}):e.push({pathname:"/organizations/".concat(s.slug,"/dashboards/new/widget/new/"),query:{...o.query,dataSet:v.qg.EVENTS}})})),(0,o.Z)(this,"handleAddComplete",(e=>{this.props.onUpdate([...this.props.dashboard.widgets,z(e)])})),(0,o.Z)(this,"handleUpdateComplete",(e=>t=>{const s=[...this.props.dashboard.widgets],o=s.indexOf(e);s[o]={...t,tempId:e.tempId},this.props.onUpdate(s)})),(0,o.Z)(this,"handleDeleteWidget",(e=>()=>{const t=this.props.dashboard.widgets.filter((t=>t!==e));this.props.onUpdate(t)})),(0,o.Z)(this,"handleEditWidget",((e,t)=>()=>{const{organization:s,dashboard:o,selection:i,router:r,location:a,paramDashboardId:n,onSetWidgetToBeUpdated:d}=this.props;if(s.features.includes("metrics")){if(d(e),n)return void r.push({pathname:"/organizations/".concat(s.slug,"/dashboard/").concat(n,"/widget/").concat(t,"/edit/"),query:{...a.query,dataSet:v.qg.EVENTS}});r.push({pathname:"/organizations/".concat(s.slug,"/dashboards/new/widget/").concat(t,"/edit/"),query:{...a.query,dataSet:v.qg.EVENTS}})}(0,u.Z)("dashboards_views.edit_widget_modal.opened",{organization:s});const l={organization:s,widget:e,selection:i,onAddWidget:this.handleAddComplete,onUpdateWidget:this.handleUpdateComplete(e)};(0,p.openAddDashboardWidgetModal)({...l,dashboard:o,source:y.EN.DASHBOARDS})}))}async componentDidMount(){const{isEditing:e}=this.props;e&&this.fetchTags(),this.addNewWidget()}async componentDidUpdate(e){const{isEditing:t,newWidget:s}=this.props;e.isEditing!==t&&t&&this.fetchTags(),s!==e.newWidget&&this.addNewWidget()}async addNewWidget(){const{api:e,organization:t,newWidget:s}=this.props;if(s)try{await(0,d.QL)(e,t.slug,s),this.handleAddComplete(s)}catch(e){(0,l.Iw)(e)}}fetchTags(){const{api:e,organization:t,selection:s}=this.props;(0,c.QK)(e,t.slug,s)}renderWidget(e,t){const{isEditing:s}=this.props,o=A(e),i=o;return(0,w.tZ)(D,{"data-grid":q(t,e.displayType),children:(0,w.tZ)(C,{widget:e,dragId:i,isEditing:s,onDelete:this.handleDeleteWidget(e),onEdit:this.handleEditWidget(e,t)})},o)}render(){const{isEditing:e,dashboard:{widgets:t},organization:s,layout:o,onLayoutChange:i}=this.props;return(0,w.BX)(M,{cols:6,rowHeight:120,margin:R,draggableHandle:".".concat(j),layout:o,onLayoutChange:e=>{i(e.filter((({i:e})=>e!==b.g)))},isDraggable:e,isResizable:e,isBounded:!0,children:[t.map(((e,t)=>this.renderWidget(e,t))),e&&t.length<y.ZU&&(0,w.tZ)("div",{"data-grid":S,children:(0,w.tZ)(b.Z,{orgFeatures:s.features,onAddWidget:this.handleStartAdd,onOpenWidgetBuilder:this.handleOpenWidgetBuilder})},b.g)]})}}E.displayName="Dashboard";const T=(0,m.Z)((0,g.Z)(E)),D=(0,i.Z)("div",{target:"e1i2i4ra1"})({name:"9etigx",styles:".react-resizable-handle{z-index:1;}"}),M=(0,i.Z)((0,a.WidthProvider)(n()),{target:"e1i2i4ra0"})({name:"vivys5",styles:".react-grid-item:hover{z-index:10;}"});function A(e){var t;return"".concat("grid-item","-").concat(null!==(t=e.id)&&void 0!==t?t:e.tempId)}function z(e){var t;return(null!==(t=e.id)&&void 0!==t?t:e.tempId)?e:{...e,tempId:(0,h.E)()}}function q(e,t){return{x:2*e%6,y:Number.MAX_VALUE,w:2,h:t===y.FO.BIG_NUMBER?1:2,minH:t===y.FO.BIG_NUMBER?1:2}}},"./app/views/dashboardsV2/issueWidgetCard.tsx":(e,t,s)=>{s.d(t,{Z:()=>B});var o=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/react/index.js"),r=s("../node_modules/react-lazyload/lib/index.js"),a=s("../node_modules/react-router/es/index.js"),n=s("../node_modules/lodash/isEqual.js"),d=s.n(n),l=s("../node_modules/query-string/index.js"),p=s("./app/components/charts/errorPanel.tsx"),c=s("./app/components/charts/simpleTableChart.tsx"),u=s("./app/components/charts/styles.tsx"),h=s("./app/components/charts/transparentLoadingMask.tsx"),m=s("./app/components/errorBoundary.tsx"),g=s("./app/components/links/link.tsx"),b=s("./app/components/loadingIndicator.tsx"),y=s("./app/components/menuItem.tsx"),v=s("./app/components/organizations/globalSelectionHeader/utils.tsx"),x=s("./app/components/panels/index.tsx"),Z=s("./app/components/placeholder.tsx"),w=s("./app/icons/index.tsx"),f=s("./app/locale.tsx"),C=s("./app/styles/overflowEllipsis.tsx"),_=s("./app/styles/space.tsx"),j=s("./app/utils/dates.tsx"),R=s("./app/utils/withApi.tsx"),S=s("./app/utils/withGlobalSelection.tsx"),E=s("./app/utils/withOrganization.tsx"),T=s("./app/views/dashboardsV2/widget/issueWidget/fields.tsx"),D=s("./app/views/dashboardsV2/gridLayout/dashboard.tsx"),M=s("./app/views/dashboardsV2/contextMenu.tsx"),A=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),z=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("./app/views/issueList/utils.tsx"));const q=z.qh.DATE,k=z.io.EVENTS,L=["stats","filtered","lifetime"];class N extends i.Component{constructor(...e){super(...e),(0,A.Z)(this,"state",{loading:!0,errorMessage:void 0,tableResults:[]})}componentDidMount(){this.fetchData()}componentDidUpdate(e){const{selection:t,widget:s}=this.props,[o]=e.widget.queries.reduce((([e,t],{name:s,...o})=>(e.push(o),t.push(s),[e,t])),[[],[]]),[i]=s.queries.reduce((([e,t],{name:s,...o})=>(e.push(o),t.push(s),[e,t])),[[],[]]);d()(s.displayType,e.widget.displayType)&&d()(s.interval,e.widget.interval)&&d()(i,o)&&d()(s.displayType,e.widget.displayType)&&(0,v.WO)(t,e.selection)||this.fetchData()}fetchEventData(){const{selection:e,api:t,organization:s,widget:o}=this.props;this.setState({tableResults:[]});const i=o.queries[0],r="/organizations/".concat(s.slug,"/issues/"),a={project:e.projects,environment:e.environments,query:i.conditions,sort:q,display:k,collapse:L};e.datetime.period&&(a.statsPeriod=e.datetime.period),e.datetime.end&&(a.end=(0,j.v5)(e.datetime.end)),e.datetime.start&&(a.start=(0,j.v5)(e.datetime.start)),e.datetime.utc&&(a.utc=e.datetime.utc),t.requestPromise(r,{method:"GET",data:l.stringify({...a,limit:5})}).then((e=>{this.setState({loading:!1,errorMessage:void 0,tableResults:e})})).catch((e=>{var t,s;const o=null!==(t=null==e||null===(s=e.responseJSON)||void 0===s?void 0:s.detail)&&void 0!==t?t:null;this.setState({loading:!1,errorMessage:null!=o?o:(0,f.t)("Unable to load Widget"),tableResults:[]})}))}fetchData(){this.setState({loading:!0,errorMessage:void 0}),this.fetchEventData()}render(){const{children:e}=this.props,{loading:t,tableResults:s,errorMessage:o}=this.state;return e({loading:t,tableResults:s,errorMessage:o})}}N.displayName="WidgetQueries";const P=N;var W=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class I extends i.Component{shouldComponentUpdate(e){return!d()(e.widget,this.props.widget)||!(0,v.WO)(e.selection,this.props.selection)||this.props.isEditing!==e.isEditing||this.props.isSorting!==e.isSorting||this.props.hideToolbar!==e.hideToolbar}transformTableResults(e){return e.map((({id:e,shortId:t,title:s,assignedTo:o,...i})=>{var r,a;const n={};return Object.keys(i).map((e=>{const t=i[e];n[e]=["number","string"].includes(typeof t)?t:String(t)})),{...n,id:e,"issue.id":e,issue:t,title:s,"assignee.type":null==o?void 0:o.type,"assignee.name":null!==(r=null==o?void 0:o.name)&&void 0!==r?r:"","assignee.id":null==o?void 0:o.id,"assignee.email":null!==(a=null==o?void 0:o.email)&&void 0!==a?a:""}}))}tableResultComponent({loading:e,errorMessage:t,tableResults:s}){const{location:o,organization:i,widget:r}=this.props;if(t)return(0,W.tZ)(p.Z,{children:(0,W.tZ)(w.FC,{color:"gray500",size:"lg"})});if(e)return(0,W.tZ)(V,{height:"200px"});const a=this.transformTableResults(s);return(0,W.tZ)(Y,{location:o,title:"",fields:r.queries[0].fields,loading:e,metadata:T.$,data:a,organization:i})}renderToolbar(){const{onEdit:e,onDelete:t,draggableProps:s,hideToolbar:o,isEditing:i}=this.props;return i?(0,W.tZ)(K,{children:(0,W.BX)(Q,{style:{visibility:o?"hidden":"visible"},children:[(0,W.tZ)(J,{children:(0,W.tZ)(te,{color:"textColor",className:D.re,...null==s?void 0:s.listeners,...null==s?void 0:s.attributes})}),(0,W.tZ)(J,{"data-test-id":"widget-edit",onClick:e,children:(0,W.tZ)(w.yl,{color:"textColor"})}),(0,W.tZ)(J,{"data-test-id":"widget-delete",onClick:t,children:(0,W.tZ)(w.Fz,{color:"textColor"})})]})}):null}renderContextMenu(){var e,t;const{widget:s,selection:o,organization:i,showContextMenu:r}=this.props;if(!r)return null;const{start:a,end:n,utc:d,period:p}=o.datetime,c=a&&n?{start:(0,j.v5)(a),end:(0,j.v5)(n),utc:d}:{statsPeriod:p},u="/organizations/".concat(i.slug,"/issues/?").concat(l.stringify({query:null===(e=s.queries)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.conditions,...c}));return(0,W.tZ)($,{children:(0,W.tZ)(M.Z,{children:(0,W.tZ)(g.Z,{to:u,children:(0,W.tZ)(ee,{children:(0,f.t)("Open in Issues")})})})})}renderChart(){const{widget:e,api:t,organization:s,selection:o,renderErrorMessage:r}=this.props;return(0,W.tZ)(P,{api:t,organization:s,widget:e,selection:o,children:({tableResults:e,errorMessage:t,loading:s})=>(0,W.BX)(i.Fragment,{children:["function"==typeof r?r(t):null,(0,W.tZ)(F,{loading:s}),this.tableResultComponent({tableResults:e,loading:s,errorMessage:t}),this.renderToolbar()]})})}render(){const{widget:e,noLazyLoad:t}=this.props;return(0,W.tZ)(m.Z,{customComponent:(0,W.tZ)(U,{children:(0,f.t)("Error loading widget data")}),children:(0,W.BX)(X,{isDragging:!1,children:[(0,W.BX)(H,{children:[(0,W.tZ)(G,{children:e.title}),this.renderContextMenu()]}),t?this.renderChart():(0,W.tZ)(r.ZP,{once:!0,resize:!0,height:200,children:this.renderChart()})]})})}}I.displayName="IssueWidgetCard";const B=(0,R.Z)((0,E.Z)((0,S.Z)((0,a.withRouter)(I)))),O=(0,o.Z)((e=>(0,W.tZ)(h.Z,{...e,maskBackgroundColor:"transparent"})),{target:"e185hw6a12"})({name:"1vcob1d",styles:"display:flex;justify-content:center;align-items:center"}),F=({loading:e})=>e?(0,W.tZ)(O,{visible:e,children:(0,W.tZ)(b.Z,{mini:!0})}):null;F.displayName="LoadingScreen";const V=(0,o.Z)(Z.Z,{target:"e185hw6a11"})("background-color:",(e=>e.theme.surface200),";"),U=(0,o.Z)(Z.Z,{target:"e185hw6a10"})("display:flex;align-items:center;justify-content:center;background-color:",(e=>e.theme.alert.error.backgroundLight),";border:1px solid ",(e=>e.theme.alert.error.border),";color:",(e=>e.theme.alert.error.textLight),";border-radius:",(e=>e.theme.borderRadius),";margin-bottom:",(0,_.Z)(2),";"),X=(0,o.Z)(x.s_,{shouldForwardProp:e=>"isDragging"!==e,target:"e185hw6a9"})("margin:0;visibility:",(e=>e.isDragging?"hidden":"visible"),";height:100%;min-height:96px;display:flex;flex-direction:column;"),G=(0,o.Z)(u.Gh,{target:"e185hw6a8"})(C.Z,";"),H=(0,o.Z)("div",{target:"e185hw6a7"})("padding:",(0,_.Z)(2)," ",(0,_.Z)(3)," 0 ",(0,_.Z)(3),";width:100%;display:flex;justify-content:space-between;"),Y=(0,o.Z)(c.Z,{target:"e185hw6a6"})("margin-top:",(0,_.Z)(1.5),";border-bottom-left-radius:",(e=>e.theme.borderRadius),";border-bottom-right-radius:",(e=>e.theme.borderRadius),";font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:none;"),K=(0,o.Z)("div",{target:"e185hw6a5"})("position:absolute;top:0;left:0;z-index:1;width:100%;height:100%;display:flex;justify-content:flex-end;align-items:flex-start;background-color:",(e=>e.theme.overlayBackgroundAlpha),";border-radius:",(e=>e.theme.borderRadius),";"),Q=(0,o.Z)("div",{target:"e185hw6a4"})("display:flex;margin:10px ",(0,_.Z)(2),";touch-action:none;"),J=(0,o.Z)("div",{target:"e185hw6a3"})("padding:",(0,_.Z)(1),";&:hover{cursor:pointer;}"),$=(0,o.Z)("div",{target:"e185hw6a2"})("margin-left:",(0,_.Z)(1),";"),ee=(0,o.Z)(y.Z,{target:"e185hw6a1"})("white-space:nowrap;color:",(e=>e.theme.textColor),";:hover{color:",(e=>e.theme.textColor),";}"),te=(0,o.Z)(w.LS,{target:"e185hw6a0"})({name:"1fhyj3b",styles:"&:hover{cursor:grab;}"})},"./app/views/dashboardsV2/widget/issueWidget/fields.tsx":(e,t,s)=>{var o;s.d(t,{$:()=>i}),function(e){e.ASSIGNEE="assignee",e.TITLE="title",e.ISSUE="issue",e.LEVEL="level",e.STATUS="status",e.PLATFORM="platform",e.PERMALINK="permalink",e.IS_BOOKMARKED="isBookmarked",e.IS_SUBSCRIBED="isSubscribed",e.IS_HANDLED="isHandled",e.CULPRIT="culprit"}(o||(o={}));const i={[o.ASSIGNEE]:"string",[o.TITLE]:"string",[o.ISSUE]:"string",[o.LEVEL]:"string",[o.STATUS]:"string",[o.PLATFORM]:"string",[o.PERMALINK]:"string",[o.IS_BOOKMARKED]:"boolean",[o.IS_SUBSCRIBED]:"boolean",[o.IS_HANDLED]:"boolean",[o.CULPRIT]:"string"}},"./app/views/dashboardsV2/widget/utils.tsx":(e,t,s)=>{s.d(t,{FO:()=>i,qg:()=>r,hV:()=>a});var o=s("./app/locale.tsx");let i,r;!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.TABLE="table",e.WORLD_MAP="world_map",e.BIG_NUMBER="big_number",e.STACKED_AREA="stacked_area",e.TOP_N="top_n"}(i||(i={})),function(e){e.EVENTS="events",e.METRICS="metrics"}(r||(r={}));const a={[i.AREA]:(0,o.t)("Area Chart"),[i.BAR]:(0,o.t)("Bar Chart"),[i.LINE]:(0,o.t)("Line Chart"),[i.TABLE]:(0,o.t)("Table"),[i.WORLD_MAP]:(0,o.t)("World Map"),[i.BIG_NUMBER]:(0,o.t)("Big Number"),[i.TOP_N]:(0,o.t)("Top 5 Events")}},"./app/views/dashboardsV2/widgetCard.tsx":(e,t,s)=>{s.d(t,{Z:()=>ce});var o=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/react/index.js"),r=s("../node_modules/react-lazyload/lib/index.js"),a=s("../node_modules/react-router/es/index.js"),n=s("../node_modules/lodash/isEqual.js"),d=s.n(n),l=s("./app/actionCreators/modal.tsx"),p=s("./app/components/charts/styles.tsx"),c=s("./app/components/errorBoundary.tsx"),u=s("./app/components/menuItem.tsx"),h=s("./app/components/organizations/globalSelectionHeader/utils.tsx"),m=s("./app/components/panels/index.tsx"),g=s("./app/components/placeholder.tsx"),b=s("./app/icons/index.tsx"),y=s("./app/locale.tsx"),v=s("./app/styles/overflowEllipsis.tsx"),x=s("./app/styles/space.tsx"),Z=s("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),w=s("./app/utils/discover/types.tsx"),f=s("./app/utils/withApi.tsx"),C=s("./app/utils/withGlobalSelection.tsx"),_=s("./app/utils/withOrganization.tsx"),j=s("./app/views/dashboardsV2/utils.tsx"),R=s("./app/views/dashboardsV2/widget/utils.tsx"),S=s("./app/views/dashboardsV2/gridLayout/dashboard.tsx"),E=s("./app/views/dashboardsV2/contextMenu.tsx"),T=s("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),D=s("./app/components/charts/areaChart.tsx"),M=s("./app/components/charts/barChart.tsx"),A=s("./app/components/charts/chartZoom.tsx"),z=s("./app/components/charts/errorPanel.tsx"),q=s("./app/components/charts/lineChart.tsx"),k=s("./app/components/charts/simpleTableChart.tsx"),L=s("./app/components/charts/transitionChart.tsx"),N=s("./app/components/charts/transparentLoadingMask.tsx"),P=s("./app/components/charts/utils.tsx"),W=s("./app/components/charts/worldMapChart.tsx"),I=s("./app/components/loadingIndicator.tsx"),B=s("./app/utils/discover/charts.tsx"),O=s("./app/utils/discover/fieldRenderers.tsx"),F=s("./app/utils/discover/fields.tsx"),V=s("./app/utils/getDynamicText.tsx"),U=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class X extends i.Component{shouldComponentUpdate(e){const t={...this.props,widget:{...this.props.widget,title:""}};return e={...e,widget:{...e.widget,title:""}},!d()(t,e)}tableResultComponent({loading:e,errorMessage:t,tableResults:s}){const{location:o,widget:i,organization:r}=this.props;return t?(0,U.tZ)(z.Z,{children:(0,U.tZ)(b.FC,{color:"gray500",size:"lg"})}):void 0===s||e?(0,U.tZ)(Y,{height:"200px"}):s.map(((t,a)=>{var n,d;const l=null!==(n=null===(d=i.queries[a])||void 0===d?void 0:d.fields)&&void 0!==n?n:[];return(0,U.tZ)(J,{location:o,fields:l,title:s.length>1?t.title:"",loading:e,metadata:t.meta,data:t.data,organization:r},"table:".concat(t.title))}))}bigNumberComponent({loading:e,errorMessage:t,tableResults:s}){return t?(0,U.tZ)(z.Z,{children:(0,U.tZ)(b.FC,{color:"gray500",size:"lg"})}):void 0===s||e?(0,U.tZ)(K,{children:"—"}):s.map((e=>{var t;const s=null!==(t=e.meta)&&void 0!==t?t:{},o=Object.keys(null!=s?s:{})[0];if(!o||!e.data.length)return(0,U.tZ)(K,{children:"—"},"big_number:".concat(e.title));const i=e.data[0],r=(0,O.fK)(o,s)(i);return(0,U.tZ)(K,{children:r},"big_number:".concat(e.title))}))}chartComponent(e){const{widget:t}=this.props;switch(t.displayType){case"bar":return(0,U.tZ)(M.Z,{...e});case"area":case"top_n":return(0,U.tZ)(D.Z,{stacked:!0,...e});case"world_map":return(0,U.tZ)(W.Z,{...e});case"line":default:return(0,U.tZ)(q.Z,{...e})}}render(){var e,t,s;const{theme:o,tableResults:i,timeseriesResults:r,errorMessage:a,loading:n,widget:d}=this.props;if("table"===d.displayType)return(0,U.BX)(L.Z,{loading:n,reloading:n,children:[(0,U.tZ)(H,{loading:n}),this.tableResultComponent({tableResults:i,loading:n,errorMessage:a})]});if("big_number"===d.displayType)return(0,U.BX)(L.Z,{loading:n,reloading:n,children:[(0,U.tZ)(H,{loading:n}),this.bigNumberComponent({tableResults:i,loading:n,errorMessage:a})]});if(a)return(0,U.tZ)(z.Z,{children:(0,U.tZ)(b.FC,{color:"gray500",size:"lg"})});const{location:l,router:p,selection:c}=this.props,{start:u,end:h,period:m,utc:y}=c.datetime;if("world_map"===d.displayType){const{data:e,title:t}=(0,P.JT)(i),s=[{seriesName:t,data:e}];return(0,U.BX)(L.Z,{loading:n,reloading:n,children:[(0,U.tZ)(H,{loading:n}),(0,U.tZ)(Q,{children:(0,V.Z)({value:this.chartComponent({series:s}),fixed:(0,U.tZ)(g.Z,{height:"200px",testId:"skeleton-ui"})})})]})}const v={left:0,top:0,selected:(0,P.RI)(l),formatter:e=>{const t=(0,F.hW)(e);if(null!==t){const s=(0,F.b8)(t);null!==s&&(e=s.toUpperCase())}return(0,F.by)(e)&&(e=(0,F.bQ)(e)),e}},x=null!==(e=null===(t=d.queries[0])||void 0===t||null===(s=t.fields)||void 0===s?void 0:s[0])&&void 0!==e?e:"count()",Z={grid:{left:4,right:0,top:"40px",bottom:0},seriesOptions:{showSymbol:!1},tooltip:{trigger:"axis",valueFormatter:B.CX},yAxis:{axisLabel:{color:o.chartLabel,formatter:e=>(0,B.gu)(e,x)}}};return(0,U.tZ)(A.Z,{router:p,period:m,start:u,end:h,utc:y,children:e=>{if(a)return(0,U.tZ)(z.Z,{children:(0,U.tZ)(b.FC,{color:"gray500",size:"lg"})});const t=r?o.charts.getColorPalette(r.length-2):[];"top_n"===d.displayType&&r&&r.length>5&&(t[t.length-1]=o.chartOther);const s=r?r.map(((e,s)=>({...e,color:t[s]}))):[];return(0,U.BX)(L.Z,{loading:n,reloading:n,children:[(0,U.tZ)(H,{loading:n}),(0,U.tZ)(Q,{children:(0,V.Z)({value:this.chartComponent({...e,...Z,legend:v,series:s}),fixed:(0,U.tZ)(g.Z,{height:"200px",testId:"skeleton-ui"})})})]})}})}}X.displayName="WidgetCardChart";const G=(0,o.Z)((e=>(0,U.tZ)(N.Z,{...e,maskBackgroundColor:"transparent"})),{target:"e1od7x484"})({name:"1vcob1d",styles:"display:flex;justify-content:center;align-items:center"}),H=({loading:e})=>e?(0,U.tZ)(G,{visible:e,children:(0,U.tZ)(I.Z,{mini:!0})}):null;H.displayName="LoadingScreen";const Y=(0,o.Z)(g.Z,{target:"e1od7x483"})("background-color:",(e=>e.theme.surface200),";"),K=(0,o.Z)("div",{target:"e1od7x482"})("font-size:32px;padding:",(0,x.Z)(1)," ",(0,x.Z)(3)," ",(0,x.Z)(3)," ",(0,x.Z)(3),";*{text-align:left!important;}"),Q=(0,o.Z)("div",{target:"e1od7x481"})("padding:0 ",(0,x.Z)(3)," ",(0,x.Z)(3),";"),J=(0,o.Z)(k.Z,{target:"e1od7x480"})("margin-top:",(0,x.Z)(1.5),";border-bottom-left-radius:",(e=>e.theme.borderRadius),";border-bottom-right-radius:",(e=>e.theme.borderRadius),";font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:none;"),$=(0,T.b)(X);var ee=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),te=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.symbol.description.js"),s("../node_modules/lodash/cloneDeep.js")),se=s.n(te),oe=s("./app/actionCreators/events.tsx"),ie=s("./app/utils/dates.tsx"),re=s("./app/utils/discover/genericDiscoverQuery.tsx");function ae(e,t){return{seriesName:t,data:e.data.map((([e,t])=>({name:1e3*e,value:t.reduce(((e,{count:t})=>e+t),0)})))}}function ne(e,t){let s=[];const o=e.name;if((0,P.Xe)(t)){const e=Object.keys(t).map((e=>{const s=o?"".concat(o," : ").concat(e):e,i=t[e];return[i.order||0,ae(i,s)]})).sort(((e,t)=>e[0]-t[0])).map((e=>e[1]));s=s.concat(e)}else{const i=e.fields[0],r=o?"".concat(o," : ").concat(i):i,a=ae(t,r);s.push(a)}return s}class de extends i.Component{constructor(...e){super(...e),(0,ee.Z)(this,"state",{loading:!0,queryFetchID:void 0,errorMessage:void 0,timeseriesResults:void 0,rawResults:void 0,tableResults:void 0}),(0,ee.Z)(this,"_isMounted",!1)}componentDidMount(){this._isMounted=!0,this.fetchData()}componentDidUpdate(e){var t;const{selection:s,widget:o}=this.props,[i,r]=e.widget.queries.map((e=>(e.fields=e.fields.filter((e=>!!e)),e))).reduce((([e,t],{name:s,...o})=>(e.push(s),t.push(o),[e,t])),[[],[]]),[a,n]=o.queries.map((e=>(e.fields=e.fields.filter((e=>!!e&&"equation|"!==e)),e))).reduce((([e,t],{name:s,...o})=>(e.push(s),t.push(o),[e,t])),[[],[]]);d()(o.displayType,e.widget.displayType)&&d()(o.interval,e.widget.interval)&&d()(n,r)&&d()(o.displayType,e.widget.displayType)&&(0,h.WO)(s,e.selection)?this.state.loading||d()(i,a)||(null===(t=this.state.rawResults)||void 0===t?void 0:t.length)!==o.queries.length||this.setState((e=>{const t=o.queries.reduce(((t,s,o)=>t.concat(ne(s,e.rawResults[o]))),[]);return{...e,timeseriesResults:t}})):this.fetchData()}componentWillUnmount(){this._isMounted=!1}fetchEventData(e){const{selection:t,api:s,organization:o,widget:i}=this.props;let r=[];this.setState({tableResults:[]});const a=i.queries.map((e=>{const r=(0,j.tT)(i.title,e,t);let a="";const n={per_page:5,noPagination:!0};if("table"===i.displayType)a="/organizations/".concat(o.slug,"/eventsv2/"),n.referrer="api.dashboards.tablewidget";else if("big_number"===i.displayType)a="/organizations/".concat(o.slug,"/eventsv2/"),n.per_page=1,n.referrer="api.dashboards.bignumberwidget";else{if("world_map"!==i.displayType)throw Error("Expected widget displayType to be either big_number, table or world_map");a="/organizations/".concat(o.slug,"/events-geo/"),delete n.per_page,n.referrer="api.dashboards.worldmapwidget"}return(0,re.AA)(s,a,{...r.generateQueryStringObject(),...n})}));let n=0;a.forEach((async(t,s)=>{try{var o,d;const[l]=await t,p=l;if(p.title=null!==(o=null===(d=i.queries[s])||void 0===d?void 0:d.name)&&void 0!==o?o:"",r=[...r,p],!this._isMounted)return;this.setState((t=>t.queryFetchID!==e?t:{...t,tableResults:r}))}catch(e){var l;const t=(null==e||null===(l=e.responseJSON)||void 0===l?void 0:l.detail)||(0,y.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{if(n++,!this._isMounted)return;this.setState((t=>t.queryFetchID!==e?t:{...t,loading:n!==a.length}))}}))}fetchTimeseriesData(e,t){const{selection:s,api:o,organization:i,widget:r}=this.props;this.setState({timeseriesResults:[],rawResults:[]});const{environments:a,projects:n}=s,{start:d,end:l,period:p}=s.datetime,c=function(e,t){let s="bar"===e.displayType?"1d":e.interval;s||(s="5m");const o=(0,ie.YJ)(s);if((0,P.Nm)(t)/(60*o)>66){const e=(0,P.ZS)(t,"high");if(o<(0,ie.YJ)(e))return e}return s}(r,{start:d,end:l,period:p}),u=r.queries.map((e=>{let s;return"top_n"===r.displayType?(s={organization:i,interval:c,start:d,end:l,project:n,environment:a,period:p,query:e.conditions,yAxis:(0,F.Nk)(e.fields)[0],includePrevious:!1,referrer:"api.dashboards.widget.".concat(t,"-chart"),partial:!0,topEvents:w.hY,field:e.fields},e.orderby&&(s.orderby=e.orderby)):s={organization:i,interval:c,start:d,end:l,project:n,environment:a,period:p,query:e.conditions,yAxis:e.fields,orderby:e.orderby,includePrevious:!1,referrer:"api.dashboards.widget.".concat(t,"-chart"),partial:!0},(0,oe.lI)(o,s)}));let h=0;u.forEach((async(t,s)=>{try{const o=await t;if(!this._isMounted)return;this.setState((t=>{var i,a;if(t.queryFetchID!==e)return t;const n=[...null!==(i=t.timeseriesResults)&&void 0!==i?i:[]],d=ne(r.queries[s],o);d.forEach(((e,t)=>{n[s*d.length+t]=e}));const l=se()(null!==(a=t.rawResults)&&void 0!==a?a:[]);return l[s]=o,{...t,timeseriesResults:n,rawResults:l}}))}catch(e){var o;const t=(null==e||null===(o=e.responseJSON)||void 0===o?void 0:o.detail)||(0,y.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{if(h++,!this._isMounted)return;this.setState((t=>t.queryFetchID!==e?t:{...t,loading:h!==u.length}))}}))}fetchData(){const{widget:e}=this.props,t=Symbol("queryFetchID");this.setState({loading:!0,errorMessage:void 0,queryFetchID:t}),["table","world_map","big_number"].includes(e.displayType)?this.fetchEventData(t):this.fetchTimeseriesData(t,e.displayType)}render(){const{children:e}=this.props,{loading:t,timeseriesResults:s,tableResults:o,errorMessage:i}=this.state;return e({loading:t,timeseriesResults:null==s?void 0:s.filter((e=>!!e)),tableResults:o,errorMessage:i})}}de.displayName="WidgetQueries";const le=de;class pe extends i.Component{shouldComponentUpdate(e){return!d()(e.widget,this.props.widget)||!(0,h.WO)(e.selection,this.props.selection)||this.props.isEditing!==e.isEditing||this.props.isSorting!==e.isSorting||this.props.hideToolbar!==e.hideToolbar}isAllowWidgetsToDiscover(){const{organization:e}=this.props;return e.features.includes("connect-discover-and-dashboards")}renderToolbar(){const{onEdit:e,onDelete:t,draggableProps:s,hideToolbar:o,isEditing:i}=this.props;return i?(0,U.tZ)(me,{children:(0,U.BX)(ge,{style:{visibility:o?"hidden":"visible"},children:[(0,U.tZ)(be,{children:(0,U.tZ)(ye,{color:"textColor",className:S.re,...null==s?void 0:s.listeners,...null==s?void 0:s.attributes})}),(0,U.tZ)(be,{"data-test-id":"widget-edit",onClick:()=>{e()},children:(0,U.tZ)(b.yl,{color:"textColor"})}),(0,U.tZ)(be,{"data-test-id":"widget-delete",onClick:()=>{t()},children:(0,U.tZ)(b.Fz,{color:"textColor"})})]})}):null}renderContextMenu(){const{widget:e,selection:t,organization:s,showContextMenu:o}=this.props;if(!o)return null;const i=[];if(("table"===e.displayType||this.isAllowWidgetsToDiscover())&&s.features.includes("discover-basic")&&e.queries.length){const o=(0,j.tT)(e.title,e.queries[0],t,e.displayType),r=o.getResultsViewUrlTarget(s.slug);if(this.isAllowWidgetsToDiscover()){const t=o.getYAxisOptions().map((({value:e})=>e));switch(r.query.yAxis=e.queries[0].fields.filter((e=>t.includes(e))).slice(0,3),e.displayType){case R.FO.WORLD_MAP:r.query.display=w.DC.WORLDMAP;break;case R.FO.BAR:r.query.display=w.DC.BAR}}1===e.queries.length?i.push((0,U.tZ)(a.Link,{to:r,onClick:()=>{(0,Z.Z)("dashboards_views.open_in_discover.opened",{organization:s,widget_type:e.displayType})},children:(0,U.tZ)(we,{children:(0,y.t)("Open in Discover")},"open-discover")},"open-discover-link")):i.push((0,U.tZ)(we,{onClick:t=>{t.preventDefault(),(0,Z.Z)("dashboards_views.query_selector.opened",{organization:s,widget_type:e.displayType}),(0,l.openDashboardWidgetQuerySelectorModal)({organization:s,widget:e})},children:(0,y.t)("Open in Discover")},"open-discover"))}return i.length?(0,U.tZ)(Ze,{children:(0,U.tZ)(E.Z,{children:i})}):null}renderChart(){const{widget:e,api:t,organization:s,selection:o,renderErrorMessage:r,location:a,router:n}=this.props;return(0,U.tZ)(le,{api:t,organization:s,widget:e,selection:o,children:({tableResults:t,timeseriesResults:d,errorMessage:l,loading:p})=>(0,U.BX)(i.Fragment,{children:["function"==typeof r?r(l):null,(0,U.tZ)($,{timeseriesResults:d,tableResults:t,errorMessage:l,loading:p,location:a,widget:e,selection:o,router:n,organization:s}),this.renderToolbar()]})})}render(){const{widget:e,noLazyLoad:t}=this.props;return(0,U.tZ)(c.Z,{customComponent:(0,U.tZ)(ue,{children:(0,y.t)("Error loading widget data")}),children:(0,U.BX)(he,{isDragging:!1,children:[(0,U.BX)(xe,{children:[(0,U.tZ)(ve,{children:e.title}),this.renderContextMenu()]}),t?this.renderChart():(0,U.tZ)(r.ZP,{once:!0,resize:!0,height:200,children:this.renderChart()})]})})}}pe.displayName="WidgetCard";const ce=(0,f.Z)((0,_.Z)((0,C.Z)((0,a.withRouter)(pe)))),ue=(0,o.Z)(g.Z,{target:"emngp8q9"})("display:flex;align-items:center;justify-content:center;background-color:",(e=>e.theme.alert.error.backgroundLight),";border:1px solid ",(e=>e.theme.alert.error.border),";color:",(e=>e.theme.alert.error.textLight),";border-radius:",(e=>e.theme.borderRadius),";margin-bottom:",(0,x.Z)(2),";"),he=(0,o.Z)(m.s_,{shouldForwardProp:e=>"isDragging"!==e,target:"emngp8q8"})("margin:0;visibility:",(e=>e.isDragging?"hidden":"visible"),";height:100%;min-height:96px;display:flex;flex-direction:column;"),me=(0,o.Z)("div",{target:"emngp8q7"})("position:absolute;top:0;left:0;z-index:auto;width:100%;height:100%;display:flex;justify-content:flex-end;align-items:flex-start;background-color:",(e=>e.theme.overlayBackgroundAlpha),";border-radius:",(e=>e.theme.borderRadius),";"),ge=(0,o.Z)("div",{target:"emngp8q6"})("display:flex;margin:10px ",(0,x.Z)(2),";touch-action:none;"),be=(0,o.Z)("div",{target:"emngp8q5"})("padding:",(0,x.Z)(1),";&:hover{cursor:pointer;}"),ye=(0,o.Z)(b.LS,{target:"emngp8q4"})({name:"1fhyj3b",styles:"&:hover{cursor:grab;}"}),ve=(0,o.Z)(p.Gh,{target:"emngp8q3"})(v.Z,";"),xe=(0,o.Z)("div",{target:"emngp8q2"})("padding:",(0,x.Z)(2)," ",(0,x.Z)(3)," 0 ",(0,x.Z)(3),";width:100%;display:flex;justify-content:space-between;"),Ze=(0,o.Z)("div",{target:"emngp8q1"})("margin-left:",(0,x.Z)(1),";"),we=(0,o.Z)(u.Z,{target:"emngp8q0"})("white-space:nowrap;color:",(e=>e.theme.textColor),";:hover{color:",(e=>e.theme.textColor),";}")},"./app/views/dashboardsV2/widgetWrapper.tsx":(e,t,s)=>{s.d(t,{Z:()=>r});var o=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/framer-motion/dist/es/render/dom/motion.js");const r=(0,o.Z)(i.E.div,{target:"ec3gecx0"})("position:relative;touch-action:manipulation;",(e=>{switch(e.displayType){case"big_number":return"\n          /* 2 cols */\n          grid-area: span 1 / span 2;\n\n          @media (min-width: ".concat(e.theme.breakpoints[0],") {\n            /* 4 cols */\n            grid-area: span 1 / span 1;\n          }\n\n          @media (min-width: ").concat(e.theme.breakpoints[3],") {\n            /* 6 and 8 cols */\n            grid-area: span 1 / span 2;\n          }\n        ");default:return"\n          /* 2, 4, 6 and 8 cols */\n          grid-area: span 2 / span 2;\n        "}}),";")}}]);
//# sourceMappingURL=../sourcemaps/app_views_dashboardsV2_gridLayout_dashboard_tsx.01a2241309b397c33e8f6b4ea7349beb.js.map
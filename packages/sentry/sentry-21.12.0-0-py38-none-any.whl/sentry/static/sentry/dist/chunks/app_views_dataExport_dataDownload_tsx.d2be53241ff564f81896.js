"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_dataExport_dataDownload_tsx"],{"./app/components/dataExport.tsx":(t,e,r)=>{r.d(e,{tD:()=>w,ZP:()=>Z});var o=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=(r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/react/index.js")),s=r("../node_modules/lodash/debounce.js"),i=r.n(s),a=r("../node_modules/lodash/isEqual.js"),d=r.n(a),l=r("./app/actionCreators/indicator.tsx"),c=r("./app/components/acl/feature.tsx"),p=r("./app/components/button.tsx"),u=r("./app/locale.tsx"),h=r("./app/utils/withApi.tsx"),m=r("./app/utils/withOrganization.tsx"),y=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let w;!function(t){t.IssuesByTag="Issues-by-Tag",t.Discover="Discover"}(w||(w={}));class x extends n.Component{constructor(...t){super(...t),(0,o.Z)(this,"state",this.initialState),(0,o.Z)(this,"resetState",(()=>{this.setState(this.initialState)})),(0,o.Z)(this,"startDataExport",(()=>{const{api:t,organization:{slug:e},payload:{queryType:r,queryInfo:o}}=this.props;this.setState({inProgress:!0}),t.requestPromise("/organizations/".concat(e,"/data-export/"),{includeAllArgs:!0,method:"POST",data:{query_type:r,query_info:o}}).then((([t,e,r])=>{(0,l.S9)(201===(null==r?void 0:r.status)?(0,u.t)("Sit tight. We'll shoot you an email when your data is ready for download."):(0,u.t)("It looks like we're already working on it. Sit tight, we'll email you."))})).catch((t=>{var e,r;const o=null!==(e=null==t||null===(r=t.responseJSON)||void 0===r?void 0:r.detail)&&void 0!==e?e:"We tried our hardest, but we couldn't export your data. Give it another go.";(0,l.Iw)((0,u.t)(o)),this.setState({inProgress:!1})}))}))}componentDidUpdate({payload:t}){const{payload:e}=this.props;d()(t,e)||this.resetState()}get initialState(){return{inProgress:!1}}render(){const{inProgress:t}=this.state,{children:e,disabled:r,icon:o}=this.props;return(0,y.tZ)(c.Z,{features:["organizations:discover-query"],children:t?(0,y.tZ)(p.ZP,{size:"small",priority:"default",title:"You can get on with your life. We'll email you when your data's ready.",...this.props,disabled:!0,icon:o,children:(0,u.t)("We're working on it...")}):(0,y.tZ)(p.ZP,{onClick:i()(this.startDataExport,500),disabled:r||!1,size:"small",priority:"default",title:"Put your data to work. Start your export and we'll email you when it's finished.",icon:o,...this.props,children:e||(0,u.t)("Export All to CSV")})})}}x.displayName="DataExport";const Z=(0,h.Z)((0,m.Z)(x))},"./app/views/asyncView.tsx":(t,e,r)=>{r.d(e,{Z:()=>i}),r("../node_modules/react/index.js");var o=r("./app/components/asyncComponent.tsx"),n=r("./app/components/sentryDocumentTitle.tsx"),s=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class i extends o.Z{getTitle(){return""}render(){return(0,s.tZ)(n.Z,{title:this.getTitle(),children:this.renderComponent()})}}i.displayName="AsyncView"},"./app/views/dataExport/dataDownload.tsx":(t,e,r)=>{r.r(e),r.d(e,{DownloadStatus:()=>y,default:()=>b});var o=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=r("../node_modules/react/index.js"),s=r("../node_modules/react-router/es/index.js"),i=r("./app/components/button.tsx"),a=r("./app/components/dataExport.tsx"),d=r("./app/components/dateTime.tsx"),l=r("./app/icons/index.tsx"),c=r("./app/locale.tsx"),p=r("./app/styles/space.tsx"),u=r("./app/views/asyncView.tsx"),h=r("./app/views/auth/layout.tsx"),m=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let y;!function(t){t.Early="EARLY",t.Valid="VALID",t.Expired="EXPIRED"}(y||(y={}));class w extends u.Z{getTitle(){return(0,c.t)("Download Center")}getEndpoints(){const{orgId:t,dataExportId:e}=this.props.params;return[["download","/organizations/".concat(t,"/data-export/").concat(e,"/")]]}getActionLink(t){const{orgId:e}=this.props.params;switch(t){case a.tD.IssuesByTag:return"/organizations/".concat(e,"/issues/");case a.tD.Discover:return"/organizations/".concat(e,"/discover/queries/");default:return"/"}}renderDate(t){if(!t)return null;const e=new Date(t);return(0,m.tZ)("strong",{children:(0,m.tZ)(d.Z,{date:e})})}renderEarly(){return(0,m.BX)(n.Fragment,{children:[(0,m.tZ)(x,{children:(0,m.BX)("h3",{children:[(0,c.t)("What are"),(0,m.tZ)("i",{children:(0,c.t)(" you ")}),(0,c.t)("doing here?")]})}),(0,m.BX)(Z,{children:[(0,m.tZ)("p",{children:(0,c.t)("Not that its any of our business, but were you invited to this page? It's just that we don't exactly remember emailing you about it.")}),(0,m.tZ)("p",{children:(0,c.t)("Close this window and we'll email you when your download is ready.")})]})]})}renderExpired(){const{query:t}=this.state.download,e=this.getActionLink(t.type);return(0,m.BX)(n.Fragment,{children:[(0,m.tZ)(x,{children:(0,m.tZ)("h3",{children:(0,c.t)("This is awkward.")})}),(0,m.BX)(Z,{children:[(0,m.tZ)("p",{children:(0,c.t)("That link expired, so your download doesn't live here anymore. Just picked up one day and left town.")}),(0,m.tZ)("p",{children:(0,c.t)("Make a new one with your latest data. Your old download will never see it coming.")}),(0,m.tZ)(g,{href:e,priority:"primary",children:(0,c.t)("Start a New Download")})]})]})}openInDiscover(){const{download:{query:{info:t}}}=this.state,{orgId:e}=this.props.params,r={pathname:"/organizations/".concat(e,"/discover/results/"),query:t};s.browserHistory.push(r)}renderOpenInDiscover(){const{download:{query:t={type:a.tD.IssuesByTag,info:{}}}}=this.state,{type:e=a.tD.IssuesByTag}=t;return"Discover"===e?(0,m.BX)(n.Fragment,{children:[(0,m.tZ)("p",{children:(0,c.t)("Need to make changes?")}),(0,m.tZ)(i.ZP,{priority:"primary",onClick:()=>this.openInDiscover(),children:(0,c.t)("Open in Discover")}),(0,m.tZ)("br",{})]}):null}renderValid(){const{download:{dateExpired:t,checksum:e}}=this.state,{orgId:r,dataExportId:o}=this.props.params;return(0,m.BX)(n.Fragment,{children:[(0,m.tZ)(x,{children:(0,m.tZ)("h3",{children:(0,c.t)("All done.")})}),(0,m.BX)(Z,{children:[(0,m.tZ)("p",{children:(0,c.t)("See, that wasn't so bad. Your data is all ready for download.")}),(0,m.tZ)(i.ZP,{priority:"primary",icon:(0,m.tZ)(l.Dj,{}),href:"/api/0/organizations/".concat(r,"/data-export/").concat(o,"/?download=true"),children:(0,c.t)("Download CSV")}),(0,m.BX)("p",{children:[(0,c.t)("That link won't last forever â€” it expires:"),(0,m.tZ)("br",{}),this.renderDate(t)]}),this.renderOpenInDiscover(),(0,m.BX)("p",{children:[(0,m.tZ)("small",{children:(0,m.BX)("strong",{children:["SHA1:",e]})}),(0,m.tZ)("br",{}),(0,c._N)("Need help verifying? [link].",{link:(0,m.tZ)("a",{href:"https://docs.sentry.io/product/discover-queries/query-builder/#filter-by-table-columns",target:"_blank",rel:"noopener noreferrer",children:(0,c.t)("Check out our docs")})})]})]})]})}renderError(){var t;const{errors:{download:e}}=this.state,r=null==e||null===(t=e.responseJSON)||void 0===t?void 0:t.detail;return(0,m.tZ)(h.Z,{children:(0,m.BX)("main",{children:[(0,m.tZ)(x,{children:(0,m.BX)("h3",{children:[e.status," - ",e.statusText]})}),r&&(0,m.tZ)(Z,{children:(0,m.tZ)("p",{children:r})})]})})}renderContent(){const{download:t}=this.state;switch(t.status){case y.Early:return this.renderEarly();case y.Expired:return this.renderExpired();default:return this.renderValid()}}renderBody(){return(0,m.tZ)(h.Z,{children:(0,m.tZ)("main",{children:this.renderContent()})})}}const x=(0,o.Z)("header",{target:"eq2c1c22"})("border-bottom:1px solid ",(t=>t.theme.border),";padding:",(0,p.Z)(3)," 40px 0;h3{font-size:24px;margin:0 0 ",(0,p.Z)(3)," 0;}"),Z=(0,o.Z)("div",{target:"eq2c1c21"})("padding:",(0,p.Z)(2)," 40px;max-width:500px;p{margin:",(0,p.Z)(1.5)," 0;}"),g=(0,o.Z)(i.ZP,{target:"eq2c1c20"})("margin-bottom:",(0,p.Z)(1.5),";"),b=w}}]);
//# sourceMappingURL=../sourcemaps/app_views_dataExport_dataDownload_tsx.0420714c12be5ee062d03627a69b206d.js.map
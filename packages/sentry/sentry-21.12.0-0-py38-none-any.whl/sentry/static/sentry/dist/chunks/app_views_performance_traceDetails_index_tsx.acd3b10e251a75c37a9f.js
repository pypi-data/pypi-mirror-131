"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_performance_traceDetails_index_tsx"],{"./app/utils/performance/quickTrace/traceFullQuery.tsx":(t,e,n)=>{n.d(e,{g:()=>p,H:()=>u});var r=n("../node_modules/react/index.js"),a=n("./app/utils/discover/genericDiscoverQuery.tsx"),s=n("./app/utils/performance/quickTrace/utils.tsx"),i=n("./app/utils/withApi.tsx"),o=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function c({detailed:t,eventId:e,...n}){const r=(0,s.eF)(n);return r.detailed=t?"1":"0",e&&(r.event_id=e),r}function l({children:t}){return(0,o.tZ)(r.Fragment,{children:t({isLoading:!1,error:null,traces:null,type:"full"})})}function d({traceId:t,start:e,end:n,statsPeriod:r,children:i,...d}){if(!t)return(0,o.tZ)(l,{children:i});const p=(0,s._Z)({start:e,end:n,statsPeriod:r});return(0,o.tZ)(a.ZP,{route:"events-trace/".concat(t),getRequestPayload:c,eventView:p,...d,children:({tableData:t,...e})=>i({traces:t||null,type:"full",...e})})}l.displayName="EmptyTrace",d.displayName="GenericTraceFullQuery";const p=(0,i.Z)((t=>(0,o.tZ)(d,{...t,detailed:!1}))),u=(0,i.Z)((t=>(0,o.tZ)(d,{...t,detailed:!0})))},"./app/utils/performance/quickTrace/traceMetaQuery.tsx":(t,e,n)=>{n.d(e,{Z:()=>l});var r=n("../node_modules/react/index.js"),a=n("./app/utils/discover/genericDiscoverQuery.tsx"),s=n("./app/utils/performance/quickTrace/utils.tsx"),i=n("./app/utils/withApi.tsx"),o=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function c({traceId:t,start:e,end:n,statsPeriod:i,children:c,...l}){if(!t)return(0,o.tZ)(r.Fragment,{children:c({isLoading:!1,error:null,meta:null})});const d=(0,s._Z)({start:e,end:n,statsPeriod:i});return(0,o.tZ)(a.ZP,{route:"events-trace-meta/".concat(t),getRequestPayload:s.eF,eventView:d,...l,children:({tableData:t,...e})=>c({meta:t,...e})})}c.displayName="TraceMetaQuery";const l=(0,i.Z)(c)},"./app/views/performance/breadcrumb.tsx":(t,e,n)=>{n.d(e,{Z:()=>f});var r=n("../node_modules/react/index.js"),a=n("./app/components/breadcrumbs.tsx"),s=n("./app/locale.tsx"),i=n("./app/utils/queryString.tsx"),o=n("./app/views/performance/transactionSummary/tabs.tsx"),c=n("./app/views/performance/transactionSummary/transactionEvents/utils.tsx"),l=n("./app/views/performance/transactionSummary/transactionTags/utils.tsx"),d=n("./app/views/performance/transactionSummary/transactionVitals/utils.tsx"),p=n("./app/views/performance/transactionSummary/utils.tsx"),u=n("./app/views/performance/vitalDetail/utils.tsx"),h=n("./app/views/performance/utils.tsx"),m=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class g extends r.Component{getCrumbs(){const t=[],{organization:e,location:n,transaction:r,vitalName:a,eventSlug:m,traceSlug:g,transactionComparison:f,tab:x}=this.props,v={pathname:(0,h.de)(e),query:{...n.query,transaction:void 0}};if(t.push({to:v,label:(0,s.t)("Performance"),preserveGlobalSelection:!0}),a){const r=(0,u.i4)({orgSlug:e.slug,vitalName:"fcp",projectID:(0,i.ro)(n.query.project),query:n.query});t.push({to:r,label:(0,s.t)("Vital Detail"),preserveGlobalSelection:!0})}else if(r){const a={orgSlug:e.slug,transaction:r.name,projectID:r.project,query:n.query};switch(x){case o.Z.Tags:{const e=(0,l.vG)(a);t.push({to:e,label:(0,s.t)("Tags"),preserveGlobalSelection:!0});break}case o.Z.Events:{const e=(0,c.xr)(a);t.push({to:e,label:(0,s.t)("All Events"),preserveGlobalSelection:!0});break}case o.Z.WebVitals:{const e=(0,d.Pl)(a);t.push({to:e,label:(0,s.t)("Web Vitals"),preserveGlobalSelection:!0});break}case o.Z.TransactionSummary:default:{const e=(0,p.e1)(a);t.push({to:e,label:(0,s.t)("Transaction Summary"),preserveGlobalSelection:!0})}}}return r&&m?t.push({to:"",label:(0,s.t)("Event Details")}):f?t.push({to:"",label:(0,s.t)("Compare to Baseline")}):g&&t.push({to:"",label:(0,s.t)("Trace View")}),t}render(){return(0,m.tZ)(a.Z,{crumbs:this.getCrumbs()})}}g.displayName="Breadcrumb";const f=g},"./app/views/performance/traceDetails/index.tsx":(t,e,n)=>{n.r(e),n.d(e,{default:()=>Lt});var r=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(n("../node_modules/core-js/modules/es.string.trim.js"),n("../node_modules/react/index.js")),s=n("./app/components/noProjectMessage.tsx"),i=n("./app/components/organizations/globalSelectionHeader/getParams.tsx"),o=n("./app/components/sentryDocumentTitle.tsx"),c=n("./app/constants/pageFilters.tsx"),l=n("./app/locale.tsx"),d=n("./app/styles/organization.tsx"),p=n("./app/utils/discover/eventView.tsx"),u=n("./app/utils/performance/quickTrace/traceFullQuery.tsx"),h=n("./app/utils/performance/quickTrace/traceMetaQuery.tsx"),m=n("./app/utils/queryString.tsx"),g=n("./app/utils/withApi.tsx"),f=n("./app/utils/withOrganization.tsx"),x=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),v=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.array.unscopables.flat-map.js"),n("../node_modules/@sentry/hub/esm/hub.js")),y=n("./app/components/alert.tsx"),Z=n("./app/components/assistant/guideAnchor.tsx"),b=n("./app/components/buttonBar.tsx"),T=n("./app/components/discover/discoverFeature.tsx"),w=n("./app/components/discoverButton.tsx"),S=n("./app/components/events/interfaces/spans/anchorLinkManager.tsx"),D=n("./app/components/events/interfaces/spans/dividerHandlerManager.tsx"),j=n("./app/components/events/interfaces/spans/scrollbarManager.tsx"),_=n("./app/components/layouts/thirds.tsx"),q=n("./app/components/links/externalLink.tsx"),z=n("./app/components/links/link.tsx"),C=n("./app/components/loadingError.tsx"),B=n("./app/components/loadingIndicator.tsx"),I=n("./app/components/performance/waterfall/messageRow.tsx"),k=n("./app/components/performance/waterfall/miniHeader.tsx"),P=n("./app/components/performance/waterfall/utils.tsx"),O=n("./app/components/timeSince.tsx"),V=n("./app/icons/index.tsx"),E=n("./app/utils/createFuzzySearch.tsx"),M=n("./app/utils/formatters.tsx"),X=n("./app/utils/getDynamicText.tsx"),A=n("./app/utils/performance/quickTrace/utils.tsx"),N=n("./app/views/performance/breadcrumb.tsx"),H=n("./app/views/performance/transactionDetails/styles.tsx"),L=n("./app/components/events/eventTags/eventTagsPill.tsx"),R=n("./app/components/events/interfaces/spans/header.tsx"),F=n("./app/components/panels/index.tsx"),G=n("./app/components/pills.tsx"),Q=n("./app/components/searchBar.tsx"),U=n("./app/styles/space.tsx"),W=n("./app/utils.tsx"),$=n("./app/views/performance/transactionSummary/utils.tsx"),K=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js"),J=n("./app/components/events/interfaces/spans/spanDetail.tsx");const Y=(0,r.Z)("div",{target:"euzgho58"})({name:"7whenc",styles:"display:flex;width:100%"}),tt=(0,r.Z)(Q.Z,{target:"euzgho57"})({name:"1ff36h2",styles:"flex-grow:1"}),et=(0,r.Z)(R.i,{target:"euzgho56"})("position:static;top:auto;border-top:none;border-bottom:1px solid ",(t=>t.theme.border),";"),nt=(0,r.Z)("div",{target:"euzgho55"})("display:grid;grid-template-columns:1fr;grid-gap:",(0,U.Z)(3),";margin-bottom:",(0,U.Z)(2),";@media (min-width: ",(t=>t.theme.breakpoints[1]),"){grid-template-columns:max-content max-content;grid-row-gap:0;}"),rt=(0,r.Z)("div",{target:"euzgho54"})("margin-top:",(0,U.Z)(2),";"),at=(0,r.Z)("div",{target:"euzgho53"})({name:"1wr20zt",styles:"overflow-x:hidden;border-bottom-left-radius:3px;border-bottom-right-radius:3px"}),st=(0,r.Z)(F.s_,{target:"euzgho52"})({name:"d3v9zr",styles:"overflow:hidden"}),it=(0,r.Z)("span",{target:"euzgho51"})("margin-right:",(0,U.Z)(.75),";display:flex;flex-direction:column;justify-content:center;"),ot=(0,r.Z)(G.Z,{target:"euzgho50"})("padding-top:",(0,U.Z)(1.5),";");function ct({location:t,organization:e,transaction:n}){const{tags:r}=n;if(!r||r.length<=0)return null;const a=e.slug,s="/organizations/".concat(a,"/releases/");return(0,K.BX)("tr",{children:[(0,K.tZ)("td",{className:"key",children:"Tags"}),(0,K.tZ)("td",{className:"value",children:(0,K.tZ)(ot,{children:r.map(((r,i)=>{const{pathname:o,query:c}=(0,$.e1)({orgSlug:a,transaction:n.transaction,projectID:String(n.project_id),query:{...t.query,query:(0,m.os)(t.query.query,r.key,r.value)}});return(0,K.tZ)(L.Z,{tag:r,projectId:n.project_slug,organization:e,query:c,streamPath:o,releasesPath:s},(0,W.ri)(r.key)?r.key:"tag-pill-".concat(i))}))})})]})}ct.displayName="Tags";var lt=n("./app/components/count.tsx"),dt=n("./app/components/idBadge/projectBadge.tsx"),pt=n("./app/components/performance/waterfall/constants.tsx"),ut=n("./app/components/performance/waterfall/row.tsx"),ht=n("./app/components/performance/waterfall/rowBar.tsx"),mt=n("./app/components/performance/waterfall/rowDivider.tsx"),gt=n("./app/components/performance/waterfall/rowTitle.tsx"),ft=n("./app/components/performance/waterfall/treeConnector.tsx"),xt=n("./app/components/tooltip.tsx"),vt=n("./app/utils/projects.tsx"),yt=n("../node_modules/react-router/es/index.js"),Zt=n("../node_modules/lodash/omit.js"),bt=n.n(Zt),Tt=n("./app/components/button.tsx"),wt=n("./app/components/dateTime.tsx"),St=n("./app/components/performance/waterfall/rowDetails.tsx"),Dt=n("./app/components/quickTrace/utils.tsx"),jt=n("./app/utils/discover/urls.tsx"),_t=n("./app/utils/performance/urls.ts"),qt=n("./app/utils/performance/vitals/constants.tsx");class zt extends a.Component{constructor(...t){super(...t),(0,x.Z)(this,"scrollBarIntoView",(t=>e=>{e.preventDefault();const n="#txn-".concat(t);this.props.scrollToHash(n),yt.browserHistory.push({...this.props.location,hash:n})}))}renderTransactionErrors(){const{organization:t,transaction:e}=this.props,{errors:n}=e;return 0===n.length?null:(0,K.tZ)(y.Z,{system:!0,type:"error",icon:(0,K.tZ)(V.FC,{size:"md"}),expand:n.map((e=>(0,K.BX)(St.TV,{children:[(0,K.tZ)(St._U,{level:e.level}),(0,K.tZ)(St.wE,{children:e.level}),(0,K.tZ)(St.St,{children:(0,K.tZ)(z.Z,{to:(0,Dt.F7)(e,t),children:e.title})})]},e.event_id))),children:(0,K.tZ)(St.CM,{children:(0,l.tn)("An error event occurred in this transaction.","%s error events occurred in this transaction.",n.length)})})}renderGoToTransactionButton(){const{location:t,organization:e,transaction:n}=this.props,r=(0,jt.JE)({id:n.event_id,project:n.project_slug}),a=(0,_t.D)(e.slug,r,n.transaction,bt()(t.query,Object.values(c.V)));return(0,K.tZ)(It,{size:"xsmall",to:a,children:(0,l.t)("View Transaction")})}renderGoToSummaryButton(){const{location:t,organization:e,transaction:n}=this.props,r=(0,$.e1)({orgSlug:e.slug,transaction:n.transaction,query:bt()(t.query,Object.values(c.V)),projectID:String(n.project_id)});return(0,K.tZ)(It,{size:"xsmall",to:r,children:(0,l.t)("View Summary")})}renderMeasurements(){const{transaction:t}=this.props,{measurements:e={}}=t,n=Object.keys(e).filter((t=>Boolean(qt.r["measurements.".concat(t)]))).sort();return n.length<=0?null:(0,K.tZ)(a.Fragment,{children:n.map((t=>{var n;return(0,K.tZ)(J.X2,{title:null===(n=qt.r["measurements.".concat(t)])||void 0===n?void 0:n.name,children:"".concat(Number(e[t].value.toFixed(3)).toLocaleString(),"ms")},t)}))})}renderTransactionDetail(){const{location:t,organization:e,transaction:n}=this.props,r=Math.min(n.start_timestamp,n.timestamp),s=Math.max(n.start_timestamp,n.timestamp),i="".concat(Number((1e3*(s-r)).toFixed(3)).toLocaleString(),"ms");return(0,K.tZ)(J.iF,{children:(0,K.tZ)("table",{className:"table key-value",children:(0,K.BX)("tbody",{children:[(0,K.tZ)(J.X2,{title:(0,K.BX)(Ct,{onClick:this.scrollBarIntoView(n.event_id),children:["Transaction ID",(0,K.tZ)(Bt,{})]}),extra:this.renderGoToTransactionButton(),children:n.event_id}),(0,K.tZ)(J.X2,{title:"Transaction",extra:this.renderGoToSummaryButton(),children:n.transaction}),(0,K.tZ)(J.X2,{title:"Transaction Status",children:n["transaction.status"]}),(0,K.tZ)(J.X2,{title:"Span ID",children:n.span_id}),(0,K.tZ)(J.X2,{title:"Project",children:n.project_slug}),(0,K.tZ)(J.X2,{title:"Start Date",children:(0,X.Z)({fixed:"Mar 19, 2021 11:06:27 AM UTC",value:(0,K.BX)(a.Fragment,{children:[(0,K.tZ)(wt.Z,{date:1e3*r})," (".concat(r,")")]})})}),(0,K.tZ)(J.X2,{title:"End Date",children:(0,X.Z)({fixed:"Mar 19, 2021 11:06:28 AM UTC",value:(0,K.BX)(a.Fragment,{children:[(0,K.tZ)(wt.Z,{date:1e3*s})," (".concat(s,")")]})})}),(0,K.tZ)(J.X2,{title:"Duration",children:i}),(0,K.tZ)(J.X2,{title:"Operation",children:n["transaction.op"]||""}),this.renderMeasurements(),(0,K.tZ)(ct,{location:t,organization:e,transaction:n})]})})})}render(){return(0,K.BX)(J.wh,{onClick:t=>{t.stopPropagation()},children:[this.renderTransactionErrors(),this.renderTransactionDetail()]})}}zt.displayName="TransactionDetail";const Ct=(0,r.Z)("a",{target:"eykqe522"})("display:flex;color:",(t=>t.theme.textColor),";:hover{color:",(t=>t.theme.textColor),";}"),Bt=(0,r.Z)(V.rS,{target:"eykqe521"})("display:block;color:",(t=>t.theme.gray300),";margin-left:",(0,U.Z)(1),";"),It=(0,r.Z)(Tt.ZP,{target:"eykqe520"})("position:absolute;top:",(0,U.Z)(.75),";right:",(0,U.Z)(.5),";"),kt=zt;class Pt extends a.Component{constructor(...t){super(...t),(0,x.Z)(this,"state",{showDetail:!1}),(0,x.Z)(this,"transactionRowDOMRef",a.createRef()),(0,x.Z)(this,"toggleDisplayDetail",(()=>{const{transaction:t}=this.props;(0,A.Ci)(t)&&this.setState((t=>({showDetail:!t.showDetail})))})),(0,x.Z)(this,"scrollIntoView",(()=>{const t=this.transactionRowDOMRef.current;if(!t)return;const e=t.getBoundingClientRect().top+window.scrollY;this.setState({showDetail:!0},(()=>window.scrollTo(0,e)))}))}getCurrentOffset(){const{transaction:t}=this.props,{generation:e}=t;return Ot(e)}renderConnector(t){const{continuingDepths:e,isExpanded:n,isOrphan:r,isLast:a,transaction:s}=this.props,{generation:i}=s,o=(0,A.Ci)(s)?s.event_id:s.traceSlug;if(0===i)return t?(0,K.tZ)(ft.UV,{style:{right:"15px",height:"10px",bottom:"-5px",top:"auto"},orphanBranch:!1}):null;const c=e.map((({depth:t,isOrphanDepth:e})=>{if(i-t<=1)return null;const n=-1*Ot(i-t-1)-2;return(0,K.tZ)(ft.UV,{style:{left:n},orphanBranch:e},"".concat(o,"-").concat(t))}));return t&&n&&c.push((0,K.tZ)(ft.UV,{style:{right:"15px",height:"10px",bottom:a?"-".concat(pt.d/2+1,"px"):"0",top:"auto"},orphanBranch:!1},"".concat(o,"-last"))),(0,K.tZ)(ft.DN,{isLast:a,hasToggler:t,orphanBranch:r,children:c})}renderToggle(t){const{isExpanded:e,transaction:n,toggleExpandedState:r}=this.props,{children:a,generation:s}=n,i=this.getCurrentOffset();if(a.length<=0)return(0,K.tZ)(ft.rw,{style:{left:"".concat(i,"px")},children:this.renderConnector(!1)});const o=0===s;return(0,K.BX)(ft.rw,{style:{left:"".concat(i,"px")},hasToggler:!0,children:[this.renderConnector(!0),(0,K.BX)(ft.U1,{disabled:o,isExpanded:e,errored:t,onClick:t=>{t.stopPropagation(),o||r()},children:[(0,K.tZ)(lt.Z,{value:a.length}),!o&&(0,K.tZ)("div",{children:(0,K.tZ)(ft.jd,{direction:e?"up":"down"})})]})]})}renderTitle(t){const{generateContentSpanBarRef:e}=t,{organization:n,transaction:r}=this.props,s=this.getCurrentOffset(),i=!!(0,A.Ci)(r)&&r.errors.length>0,o=(0,A.Ci)(r)?(0,K.BX)(a.Fragment,{children:[(0,K.tZ)(vt.Z,{orgId:n.slug,slugs:[r.project_slug],children:({projects:t})=>{const e=t.find((t=>t.slug===r.project_slug));return(0,K.tZ)(it,{children:(0,K.tZ)(xt.Z,{title:r.project_slug,children:(0,K.tZ)(dt.Z,{project:e||{slug:r.project_slug},avatarSize:16,hideName:!0})})})}}),(0,K.BX)(gt.rv,{errored:i,children:[(0,K.BX)("strong",{children:[r["transaction.op"]," — "]}),r.transaction]})]}):(0,K.BX)(gt.rv,{errored:!1,children:[(0,K.tZ)("strong",{children:"Trace — "}),r.traceSlug]});return(0,K.BX)(gt.mw,{ref:e(),children:[this.renderToggle(i),(0,K.tZ)(gt.Wh,{style:{left:"".concat(s,"px"),width:"100%"},children:o})]})}renderDivider(t){if(this.state.showDetail)return(0,K.tZ)(mt.xN,{showDetail:!0,style:{position:"absolute"}});const{addDividerLineRef:e}=t;return(0,K.tZ)(mt.xN,{ref:e(),style:{position:"absolute"},onMouseEnter:()=>{t.setHover(!0)},onMouseLeave:()=>{t.setHover(!1)},onMouseOver:()=>{t.setHover(!0)},onMouseDown:t.onDragStart,onClick:t=>{t.stopPropagation()}})}renderGhostDivider(t){const{dividerPosition:e,addGhostDividerLineRef:n}=t;return(0,K.tZ)(mt.Hr,{style:{width:"calc(".concat((0,P.yI)(e)," + 0.5px)"),display:"none"},children:(0,K.tZ)(mt.xN,{ref:n(),style:{right:0},className:"hovering",onClick:t=>{t.stopPropagation()}})})}renderErrorBadge(){const{transaction:t}=this.props;return(0,A.Ci)(t)&&t.errors.length?(0,K.tZ)(mt.cS,{}):null}renderRectangle(){const{transaction:t,traceInfo:e,barColor:n}=this.props,{showDetail:r}=this.state,a=Math.abs(e.endTimestamp-e.startTimestamp)||1,s=Math.abs(t.start_timestamp-e.startTimestamp)/a,i=Math.abs(t.timestamp-t.start_timestamp),o=i/a;return(0,K.tZ)(ht.e,{spanBarHatch:!1,style:{backgroundColor:n,left:"min(".concat((0,P.yI)(s||0),", calc(100% - 1px))"),width:(0,P.yI)(o||0)},children:(0,K.tZ)(ht.R,{durationDisplay:(0,P.ud)({left:s,width:o}),showDetail:r,spanBarHatch:!1,children:(0,P.bQ)(i)})})}renderHeader({dividerHandlerChildrenProps:t,scrollbarManagerChildrenProps:e}){const{hasGuideAnchor:n,index:r}=this.props,{showDetail:a}=this.state,{dividerPosition:s}=t;return(0,K.BX)(ut.Qc,{showDetail:a,children:[(0,K.tZ)(ut.E5,{"data-test-id":"transaction-row-title","data-type":"span-row-cell",style:{width:"calc(".concat((0,P.yI)(s)," - 0.5px)"),paddingTop:0},showDetail:a,onClick:this.toggleDisplayDetail,children:(0,K.tZ)(Z.Z,{target:"trace_view_guide_row",disabled:!n,children:this.renderTitle(e)})}),(0,K.BX)(mt.kP,{children:[this.renderDivider(t),this.renderErrorBadge()]}),(0,K.tZ)(ut.E5,{"data-test-id":"transaction-row-duration","data-type":"span-row-cell",showStriping:r%2!=0,style:{width:"calc(".concat((0,P.yI)(1-s)," - 0.5px)"),paddingTop:0},showDetail:a,onClick:this.toggleDisplayDetail,children:(0,K.tZ)(Z.Z,{target:"trace_view_guide_row_details",disabled:!n,children:this.renderRectangle()})}),!a&&this.renderGhostDivider(t)]})}renderDetail(){const{location:t,organization:e,isVisible:n,transaction:r}=this.props,{showDetail:a}=this.state;return(0,K.tZ)(S.$,{children:({registerScrollFn:s,scrollToHash:i})=>(0,A.Ci)(r)?(s("#txn-".concat(r.event_id),this.scrollIntoView),n&&a?(0,K.tZ)(kt,{location:t,organization:e,transaction:r,scrollToHash:i}):null):null})}render(){const{isVisible:t,transaction:e}=this.props,{showDetail:n}=this.state;return(0,K.BX)(ut.X2,{ref:this.transactionRowDOMRef,visible:t,showBorder:n,cursor:(0,A.Ci)(e)?"pointer":"default",children:[(0,K.tZ)(j.$6,{children:t=>(0,K.tZ)(D.$,{children:e=>this.renderHeader({dividerHandlerChildrenProps:e,scrollbarManagerChildrenProps:t})})}),this.renderDetail()]})}}function Ot(t){return t*(ft.Ll/2)+0}Pt.displayName="TransactionBar";const Vt=Pt;class Et extends a.Component{constructor(...t){super(...t),(0,x.Z)(this,"state",{isExpanded:!0}),(0,x.Z)(this,"toggleExpandedState",(()=>{this.setState((({isExpanded:t})=>({isExpanded:!t})))}))}componentDidUpdate(t,e){e.isExpanded!==this.state.isExpanded&&this.props.updateScrollState()}render(){const{location:t,organization:e,transaction:n,traceInfo:r,continuingDepths:s,isOrphan:i,isLast:o,index:c,isVisible:l,hasGuideAnchor:d,renderedChildren:p,barColor:u}=this.props,{isExpanded:h}=this.state;return(0,K.BX)(a.Fragment,{children:[(0,K.tZ)(Vt,{location:t,organization:e,index:c,transaction:n,traceInfo:r,continuingDepths:s,isOrphan:i,isLast:o,isExpanded:h,toggleExpandedState:this.toggleExpandedState,isVisible:l,hasGuideAnchor:d,barColor:u}),h&&p]})}}Et.displayName="TransactionGroup";const Mt=(0,j.Iw)(Et);var Xt=n("./app/views/performance/traceDetails/utils.tsx");class At extends a.Component{constructor(...t){super(...t),(0,x.Z)(this,"state",{searchQuery:void 0,filteredTransactionIds:void 0}),(0,x.Z)(this,"traceViewRef",a.createRef()),(0,x.Z)(this,"virtualScrollbarContainerRef",a.createRef()),(0,x.Z)(this,"handleTransactionFilter",(t=>{this.setState({searchQuery:t||void 0},this.filterTransactions)})),(0,x.Z)(this,"filterTransactions",(async()=>{const{traces:t}=this.props,{filteredTransactionIds:e,searchQuery:n}=this.state;if(!n||null===t||t.length<=0)return void(void 0!==e&&this.setState({filteredTransactionIds:void 0}));const r=t.flatMap((t=>(0,A.S2)(t,((t,e)=>{const n=[e["transaction.op"],e.transaction,e.project_slug];return t.push({transaction:e,indexed:n}),t}),[]))),a=(await(0,E.I)(r,{keys:["indexed"],includeMatches:!0,threshold:.6,location:0,distance:100,maxPatternLength:32})).search(n).filter((({matches:t})=>t.length)).map((({item:t})=>t.transaction.event_id)),s=t.flatMap((t=>(0,A.xB)(t,(({event_id:t,span_id:e})=>t.includes(n)||e.includes(n))))).map((t=>t.event_id));this.setState({filteredTransactionIds:new Set([...a,...s])})})),(0,x.Z)(this,"isTransactionVisible",(t=>{const{filteredTransactionIds:e}=this.state;return!e||e.has(t.event_id)}))}renderTraceLoading(){return(0,K.tZ)(B.Z,{})}renderTraceRequiresDateRangeSelection(){return(0,K.tZ)(C.Z,{message:(0,l.t)("Trace view requires a date range selection.")})}renderTraceNotFound(){var t,e;const{meta:n}=this.props,r=null!==(t=null==n?void 0:n.transactions)&&void 0!==t?t:0,a=null!==(e=null==n?void 0:n.errors)&&void 0!==e?e:0;return 0===r&&a>0?(0,K.tZ)(C.Z,{message:(0,l.t)("The trace you are looking contains only errors.")}):(0,K.tZ)(C.Z,{message:(0,l.t)("The trace you are looking for was not found.")})}renderSearchBar(){return(0,K.tZ)(Y,{children:(0,K.tZ)(tt,{defaultQuery:"",query:this.state.searchQuery||"",placeholder:(0,l.t)("Search for transactions"),onSearch:this.handleTransactionFilter})})}renderTraceHeader(t){var e,n,r;const{meta:a}=this.props;return(0,K.BX)(nt,{children:[(0,K.tZ)(Z.Z,{target:"trace_view_guide_breakdown",children:(0,K.tZ)(H.U,{headingText:(0,l.t)("Event Breakdown"),tooltipText:(0,l.t)("The number of transactions and errors there are in this trace."),bodyText:(0,l._N)("[transactions]  |  [errors]",{transactions:(0,l.tn)("%s Transaction","%s Transactions",null!==(e=null==a?void 0:a.transactions)&&void 0!==e?e:t.transactions.size),errors:(0,l.tn)("%s Error","%s Errors",null!==(n=null==a?void 0:a.errors)&&void 0!==n?n:t.errors.size)}),subtext:(0,l.tn)("Across %s project","Across %s projects",null!==(r=null==a?void 0:a.projects)&&void 0!==r?r:t.projects.size)})}),(0,K.tZ)(H.U,{headingText:(0,l.t)("Total Duration"),tooltipText:(0,l.t)("The time elapsed between the start and end of this trace."),bodyText:(0,M.g9)(t.endTimestamp-t.startTimestamp,2,!0),subtext:(0,X.Z)({value:(0,K.tZ)(O.Z,{date:1e3*(t.endTimestamp||0)}),fixed:"5 days ago"})})]})}renderTraceWarnings(){const{traces:t}=this.props,{roots:e,orphans:n}=(null!=t?t:[]).reduce(((t,e)=>((0,Xt.uM)(e)?t.roots++:t.orphans++,t)),{roots:0,orphans:0});let r=null;return 0===e&&n>0?r=(0,K.tZ)(y.Z,{type:"info",icon:(0,K.tZ)(V.aU,{size:"sm"}),children:(0,K.tZ)(q.Z,{href:"https://docs.sentry.io/product/performance/trace-view/#orphan-traces-and-broken-subtraces",children:(0,l.t)("A root transaction is missing. Transactions linked by a dashed line have been orphaned and cannot be directly linked to the root.")})}):1===e&&n>0?r=(0,K.tZ)(y.Z,{type:"info",icon:(0,K.tZ)(V.aU,{size:"sm"}),children:(0,K.tZ)(q.Z,{href:"https://docs.sentry.io/product/performance/trace-view/#orphan-traces-and-broken-subtraces",children:(0,l.t)("This trace has broken subtraces. Transactions linked by a dashed line have been orphaned and cannot be directly linked to the root.")})}):e>1&&(r=(0,K.tZ)(y.Z,{type:"info",icon:(0,K.tZ)(V.aU,{size:"sm"}),children:(0,K.tZ)(q.Z,{href:"https://docs.sentry.io/product/performance/trace-view/#multiple-roots",children:(0,l.t)("Multiple root transactions have been found with this trace ID.")})})),r}renderInfoMessage({isVisible:t,numberOfHiddenTransactionsAbove:e}){const n=[];return t&&(1===e?n.push((0,K.tZ)("span",{children:(0,l._N)("[numOfTransaction] hidden transaction",{numOfTransaction:(0,K.tZ)("strong",{children:e})})},"stuff")):e>1&&n.push((0,K.tZ)("span",{children:(0,l._N)("[numOfTransaction] hidden transactions",{numOfTransaction:(0,K.tZ)("strong",{children:e})})},"stuff"))),n.length<=0?null:(0,K.tZ)(I.V,{children:n})}renderLimitExceededMessage(t){var e;const{traceEventView:n,organization:r,meta:a}=this.props,s=t.transactions.size,i=null!==(e=null==a?void 0:a.transactions)&&void 0!==e?e:s;if(null===i||s>=i)return null;const o=n.getResultsViewUrlTarget(r.slug);return(0,K.tZ)(I.V,{children:(0,l._N)("Limited to a view of [count] transactions. To view the full list, [discover].",{count:s,discover:(0,K.tZ)(T.Z,{children:({hasFeature:t})=>(0,K.tZ)(z.Z,{disabled:!t,to:o,children:"Open in Discover"})})})})}renderTransaction(t,{continuingDepths:e,isOrphan:n,isLast:r,index:s,numberOfHiddenTransactionsAbove:i,traceInfo:o,hasGuideAnchor:c}){const{location:l,organization:d}=this.props,{children:p,event_id:u}=t,h=t.generation+1,m=this.isTransactionVisible(t),g=p.reduce(((t,r,a)=>{const s=a===p.length-1,i=r.children.length>0,c=this.renderTransaction(r,{continuingDepths:!s&&i?[...e,{depth:h,isOrphanDepth:n}]:e,isOrphan:n,isLast:s,index:t.lastIndex+1,numberOfHiddenTransactionsAbove:t.numberOfHiddenTransactionsAbove,traceInfo:o,hasGuideAnchor:!1});return t.lastIndex=c.lastIndex,t.numberOfHiddenTransactionsAbove=c.numberOfHiddenTransactionsAbove,t.renderedChildren.push(c.transactionGroup),t}),{renderedChildren:[],lastIndex:s,numberOfHiddenTransactionsAbove:m?0:i+1});return{transactionGroup:(0,K.BX)(a.Fragment,{children:[this.renderInfoMessage({isVisible:m,numberOfHiddenTransactionsAbove:i}),(0,K.tZ)(Mt,{location:l,organization:d,traceInfo:o,transaction:{...t,generation:h},continuingDepths:e,isOrphan:n,isLast:r,index:s,isVisible:m,hasGuideAnchor:c,renderedChildren:g.renderedChildren,barColor:(0,P.hd)(t["transaction.op"])})]},u),lastIndex:g.lastIndex,numberOfHiddenTransactionsAbove:g.numberOfHiddenTransactionsAbove}}renderTraceView(t){var e;const n=null===(e=v.Gd().getScope())||void 0===e?void 0:e.getTransaction(),r=null==n?void 0:n.startChild({op:"trace.render",description:"trace-view-content"}),{location:a,organization:s,traces:i,traceSlug:o}=this.props;if(null===i||i.length<=0)return this.renderTraceNotFound();const c={index:1,numberOfHiddenTransactionsAbove:0,traceInfo:t,transactionGroups:[]},{transactionGroups:l,numberOfHiddenTransactionsAbove:d}=i.reduce(((t,e,n)=>{const r=n===i.length-1,a=e.children.length>0,s=!r&&null!==i[n+1].parent_span_id,o=this.renderTransaction(e,{...t,isOrphan:!(0,Xt.uM)(e),isLast:r,continuingDepths:!r&&a?[{depth:0,isOrphanDepth:s}]:[],hasGuideAnchor:0===n});return t.index=o.lastIndex+1,t.numberOfHiddenTransactionsAbove=o.numberOfHiddenTransactionsAbove,t.transactionGroups.push(o.transactionGroup),t}),c),p=(0,K.tZ)(rt,{children:(0,K.tZ)(D.z,{interactiveLayerRef:this.traceViewRef,children:(0,K.tZ)(D.$,{children:({dividerPosition:e})=>(0,K.tZ)(j.zt,{dividerPosition:e,interactiveLayerRef:this.virtualScrollbarContainerRef,children:(0,K.BX)(st,{children:[(0,K.BX)(et,{children:[(0,K.tZ)(j.$6,{children:({virtualScrollbarRef:t,scrollBarAreaRef:n,onDragStart:r,onScroll:a})=>(0,K.BX)(k.cs,{ref:this.virtualScrollbarContainerRef,style:{width:"calc(".concat((0,P.yI)(e)," - 0.5px)")},onScroll:a,children:[(0,K.tZ)("div",{style:{width:0,height:"1px"},ref:n}),(0,K.tZ)(k.Qk,{"data-type":"virtual-scrollbar",ref:t,onMouseDown:r,children:(0,K.tZ)(k.v6,{})})]})}),(0,K.tZ)(k._i,{})]}),(0,K.BX)(at,{ref:this.traceViewRef,children:[(0,K.tZ)(S.z,{children:(0,K.tZ)(Mt,{location:a,organization:s,traceInfo:t,transaction:{traceSlug:o,generation:0,"transaction.duration":t.endTimestamp-t.startTimestamp,children:i,start_timestamp:t.startTimestamp,timestamp:t.endTimestamp},continuingDepths:[],isOrphan:!1,isLast:!1,index:0,isVisible:!0,hasGuideAnchor:!1,renderedChildren:l,barColor:(0,P.hd)("")})}),this.renderInfoMessage({isVisible:!0,numberOfHiddenTransactionsAbove:d}),this.renderLimitExceededMessage(t)]})]})})})})});return null==r||r.finish(),p}renderContent(){const{dateSelected:t,isLoading:e,error:n,traces:r}=this.props;if(!t)return this.renderTraceRequiresDateRangeSelection();if(e)return this.renderTraceLoading();if(null!==n||null===r||r.length<=0)return this.renderTraceNotFound();const s=(0,Xt.Rg)(r);return(0,K.BX)(a.Fragment,{children:[this.renderTraceWarnings(),this.renderTraceHeader(s),this.renderSearchBar(),this.renderTraceView(s)]})}render(){const{organization:t,location:e,traceEventView:n,traceSlug:r}=this.props;return(0,K.BX)(a.Fragment,{children:[(0,K.BX)(_.h4,{children:[(0,K.BX)(_.oB,{children:[(0,K.tZ)(N.Z,{organization:t,location:e,traceSlug:r}),(0,K.tZ)(_.Dx,{"data-test-id":"trace-header",children:(0,l.t)("Trace ID: %s",r)})]}),(0,K.tZ)(_.kP,{children:(0,K.tZ)(b.ZP,{gap:1,children:(0,K.tZ)(w.Z,{to:n.getResultsViewUrlTarget(t.slug),children:"Open in Discover"})})})]}),(0,K.tZ)(_.uT,{children:(0,K.tZ)(_.or,{fullWidth:!0,children:this.renderContent()})})]})}}At.displayName="TraceDetailsContent";const Nt=At;class Ht extends a.Component{getDocumentTitle(){return[(0,l.t)("Trace Details"),(0,l.t)("Performance")].join(" - ")}getTraceSlug(){const{traceSlug:t}=this.props.params;return"string"==typeof t?t.trim():""}getDateSelection(){const{location:t}=this.props,e=(0,i.Q)(t.query,{allowAbsolutePageDatetime:!0});return{start:(0,m.ro)(e.start),end:(0,m.ro)(e.end),statsPeriod:(0,m.ro)(e.statsPeriod)}}getTraceEventView(){const t=this.getTraceSlug(),{start:e,end:n,statsPeriod:r}=this.getDateSelection();return p.ZP.fromSavedQuery({id:void 0,name:"Events with Trace ID ".concat(t),fields:["title","event.type","project","timestamp"],orderby:"-timestamp",query:"trace:".concat(t),projects:[c.mP],version:2,start:e,end:n,range:r})}renderContent(){const{location:t,organization:e,params:n}=this.props,r=this.getTraceSlug(),{start:a,end:s,statsPeriod:i}=this.getDateSelection(),o=Boolean(i||a&&s),c=({isLoading:a,error:s,traces:i,meta:c})=>(0,K.tZ)(Nt,{location:t,organization:e,params:n,traceSlug:r,traceEventView:this.getTraceEventView(),dateSelected:o,isLoading:a,error:s,traces:i,meta:c});return o?(0,K.tZ)(u.H,{location:t,orgSlug:e.slug,traceId:r,start:a,end:s,statsPeriod:i,children:n=>(0,K.tZ)(h.Z,{location:t,orgSlug:e.slug,traceId:r,start:a,end:s,statsPeriod:i,children:t=>c({isLoading:n.isLoading||t.isLoading,error:n.error||t.error,traces:n.traces,meta:t.meta})})}):c({isLoading:!1,error:"date selection not specified",traces:null,meta:null})}render(){const{organization:t}=this.props;return(0,K.tZ)(o.Z,{title:this.getDocumentTitle(),orgSlug:t.slug,children:(0,K.tZ)(Rt,{children:(0,K.tZ)(s.Z,{organization:t,children:this.renderContent()})})})}}Ht.displayName="TraceSummary";const Lt=(0,f.Z)((0,g.Z)(Ht)),Rt=(0,r.Z)(d.JH,{target:"eqzhpg90"})({name:"1hcx8jb",styles:"padding:0"})},"./app/views/performance/transactionDetails/styles.tsx":(t,e,n)=>{n.d(e,{U:()=>l});var r=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(n("../node_modules/react/index.js"),n("./app/components/charts/styles.tsx")),s=n("./app/components/featureBadge.tsx"),i=n("./app/components/questionTooltip.tsx"),o=n("./app/styles/space.tsx"),c=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function l({headingText:t,tooltipText:e,bodyText:n,subtext:r,badge:a}){return(0,c.BX)(d,{children:[(0,c.BX)(p,{children:[t,(0,c.tZ)(i.Z,{position:"top",size:"sm",containerDisplayMode:"block",title:e}),a&&(0,c.tZ)(h,{type:a})]}),(0,c.tZ)(u,{children:n}),(0,c.tZ)(m,{children:r})]})}l.displayName="MetaData";const d=(0,r.Z)("div",{target:"eqz9f144"})({name:"4ks2md",styles:"height:78px"}),p=(0,r.Z)(a.OT,{target:"eqz9f143"})({name:"ti75j2",styles:"margin:0"}),u=(0,r.Z)("div",{target:"eqz9f142"})("font-size:",(t=>t.theme.fontSizeExtraLarge),";padding:",(0,o.Z)(.5)," 0;max-height:32px;"),h=(0,r.Z)(s.Z,{target:"eqz9f141"})({name:"ti75j2",styles:"margin:0"}),m=(0,r.Z)("div",{target:"eqz9f140"})("color:",(t=>"error"===t.type?t.theme.error:t.theme.subText),";font-size:",(t=>t.theme.fontSizeMedium),";")},"./app/views/performance/transactionSummary/tabs.tsx":(t,e,n)=>{var r;n.d(e,{Z:()=>a}),function(t){t[t.TransactionSummary=0]="TransactionSummary",t[t.WebVitals=1]="WebVitals",t[t.Tags=2]="Tags",t[t.Events=3]="Events",t[t.Spans=4]="Spans"}(r||(r={}));const a=r},"./app/views/performance/transactionSummary/transactionEvents/utils.tsx":(t,e,n)=>{n.d(e,{q3:()=>o,_S:()=>c,xr:()=>l,tb:()=>d,qg:()=>p,Zq:()=>u});var r=n("./app/locale.tsx"),a=n("./app/utils/queryString.tsx"),s=n("./app/views/performance/transactionSummary/filter.tsx"),i=n("./app/views/performance/transactionSummary/utils.tsx");let o;function c(t,e){const{p99:n,p95:a,p75:i,p50:c}=e||{p99:0,p95:0,p75:0,p50:0};return{[o.p50]:{name:o.p50,query:c?[["transaction.duration","<=".concat(c.toFixed(0))]]:void 0,sort:{kind:"desc",field:(0,s.T$)(t)||"transaction.duration"},label:(0,r.t)("p50")},[o.p75]:{name:o.p75,query:i?[["transaction.duration","<=".concat(i.toFixed(0))]]:void 0,sort:{kind:"desc",field:(0,s.T$)(t)||"transaction.duration"},label:(0,r.t)("p75")},[o.p95]:{name:o.p95,query:a?[["transaction.duration","<=".concat(a.toFixed(0))]]:void 0,sort:{kind:"desc",field:(0,s.T$)(t)||"transaction.duration"},label:(0,r.t)("p95")},[o.p99]:{name:o.p99,query:n?[["transaction.duration","<=".concat(n.toFixed(0))]]:void 0,sort:{kind:"desc",field:(0,s.T$)(t)||"transaction.duration"},label:(0,r.t)("p99")},[o.p100]:{name:o.p100,label:(0,r.t)("p100")}}}function l({orgSlug:t,transaction:e,projectID:n,query:r}){return{pathname:"/organizations/".concat(t,"/performance/summary/events/"),query:{transaction:e,project:n,environment:r.environment,statsPeriod:r.statsPeriod,start:r.start,end:r.end,query:r.query}}}function d(t){return e=(0,a.ro)(t.query.showTransactions,o.p100),Object.values(o).includes(e)?e:o.p100;var e}function p(t,e){var n,r;const a=c(e),s=null===(n=a[t].sort)||void 0===n?void 0:n.kind,i=null===(r=a[t].sort)||void 0===r?void 0:r.field,o={showTransactions:t};return s&&i&&(o.sort="".concat("desc"===s?"-":"").concat(i)),o}function u(t){switch(t){case i.K0.OUTLIER:return o.p100;case i.K0.SLOW:return o.p95;default:return}}!function(t){t.p50="p50",t.p75="p75",t.p95="p95",t.p99="p99",t.p100="p100"}(o||(o={}))},"./app/views/performance/transactionSummary/transactionTags/utils.tsx":(t,e,n)=>{n.d(e,{Zn:()=>s,bZ:()=>i,vG:()=>o,oc:()=>c,oT:()=>l});var r=n("./app/utils/analytics.tsx"),a=n("./app/utils/queryString.tsx");function s(t){return(0,a.ro)(t.query.tagKey)}function i(t){(0,r.ec)({eventKey:"performance_views.tags.interaction",eventName:"Performance Views: Tag Page - Interaction",organization_id:parseInt(t.id,10)})}function o({orgSlug:t,transaction:e,projectID:n,query:r}){return{pathname:function({orgSlug:t}){return"/organizations/".concat(t,"/performance/summary/tags/")}({orgSlug:t}),query:{transaction:e,project:n,environment:r.environment,statsPeriod:r.statsPeriod,start:r.start,end:r.end,query:r.query,tagKey:r.tagKey}}}function c(t){var e,n;let r=null!==(e=(0,a.ro)(null===(n=t.query)||void 0===n?void 0:n.tagSort))&&void 0!==e?e:"-frequency";return["sumdelta"].find((t=>{var e;return null===(e=r)||void 0===e?void 0:e.includes(t)}))&&(r="-frequency"),r}function l(t){const e=Object.keys(t).find((t=>t.includes("histogram")));if(!e)return;const n=e.split("_");return{histogramField:e,bucketSize:parseInt(n[n.length-3],10),offset:parseInt(n[n.length-2],10),multiplier:parseInt(n[n.length-1],10)}}},"./app/views/performance/transactionSummary/transactionVitals/utils.tsx":(t,e,n)=>{n.d(e,{Pl:()=>a,oZ:()=>s,eH:()=>i,L0:()=>o,jb:()=>c});var r=n("./app/utils/performance/histogram/utils.tsx");function a({orgSlug:t,transaction:e,projectID:n,query:r}){return{pathname:function({orgSlug:t}){return"/organizations/".concat(t,"/performance/summary/vitals/")}({orgSlug:t}),query:{transaction:e,project:n,environment:r.environment,statsPeriod:r.statsPeriod,start:r.start,end:r.end,query:r.query}}}function s(t,e){const n=(0,r.te)(t);return!t.length||e>=t[t.length-1].bin+n?null:e<t[0].bin?-1:Math.floor((e-t[0].bin)/n)}function i(t){if(t.length<2)return null;for(let e=0;e<t.length;e++){const n=t[e];for(let r=e+1;r<t.length;r++){const a=t[r];if(n.bin!==a.bin&&n.count!==a.count)return{point1:{x:e,y:Math.min(n.count,a.count)},point2:{x:r,y:Math.max(n.count,a.count)}}}}return{point1:{x:0,y:0},point2:{x:1,y:1}}}function o(t,e){const n=t.convertToPixel({xAxisIndex:0,yAxisIndex:0},[e.point1.x,e.point1.y]);if(isNaN(null==n?void 0:n[0])||isNaN(null==n?void 0:n[1]))return null;const r=t.convertToPixel({xAxisIndex:0,yAxisIndex:0},[e.point2.x,e.point2.y]);return isNaN(null==r?void 0:r[0])||isNaN(null==r?void 0:r[1])?null:{point1:{x:n[0],y:n[1]},point2:{x:r[0],y:r[1]}}}function c(t,e,n){if(e.point1.x===e.point2.x||e.point1.y===e.point2.y||n.point1.x===n.point2.x||n.point1.y===n.point2.y)return null;const r=(t.x-e.point1.x)/(e.point2.x-e.point1.x),a=(t.y-e.point1.y)/(e.point2.y-e.point1.y);return{x:n.point1.x+(n.point2.x-n.point1.x)*r,y:n.point1.y+(n.point2.y-n.point1.y)*a}}}}]);
//# sourceMappingURL=../sourcemaps/app_views_performance_traceDetails_index_tsx.6f64e65e1f7c206452aa8306f63549b5.js.map
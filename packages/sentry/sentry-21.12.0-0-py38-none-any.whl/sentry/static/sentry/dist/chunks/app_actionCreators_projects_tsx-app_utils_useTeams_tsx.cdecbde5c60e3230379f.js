"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_actionCreators_projects_tsx-app_utils_useTeams_tsx"],{"./app/actionCreators/projects.tsx":(e,t,o)=>{o.d(t,{Vx:()=>l,Nh:()=>m,$P:()=>g,pK:()=>f,rR:()=>S,bL:()=>j,Oe:()=>v,M9:()=>I,TA:()=>Z,$L:()=>y,iC:()=>x,xV:()=>E,mf:()=>T}),o("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=o("../node_modules/lodash/chunk.js"),r=o.n(s),a=o("../node_modules/lodash/debounce.js"),n=o.n(a),c=o("./app/actionCreators/indicator.tsx"),i=o("./app/actions/projectActions.tsx"),u=o("./app/locale.tsx"),d=o("./app/stores/projectsStatsStore.tsx");function l(e,t){i.Z.update(t.projectId,t.data);const o="/projects/".concat(t.orgId,"/").concat(t.projectId,"/");return e.requestPromise(o,{method:"PUT",data:t.data}).then((e=>(i.Z.updateSuccess(e),e)),(e=>{throw i.Z.updateError(e,t.projectId),e}))}function m(e,t){i.Z.loadStats(t.orgId,t.data);const o="/organizations/".concat(t.orgId,"/stats/");e.request(o,{query:t.query,success:e=>{i.Z.loadStatsSuccess(e)},error:e=>{i.Z.loadStatsError(e)}})}const p=new Set,h=n()(((e,t,o)=>{const s=d.Z.getAll(),a=Object.values(s).map((({id:e})=>e)),n=Array.from(t).filter((e=>!a.includes(e)));if(!n.length)return void p.clear();const l=r()(n,10).map((t=>((e,t,o,s)=>{const r=t.map((e=>"id:".concat(e))).join(" "),a="/organizations/".concat(o,"/projects/"),n={statsPeriod:"24h",query:r,...s};return e.requestPromise(a,{query:n})})(e,t,o.orgId,o.query)));Promise.all(l).then((e=>{i.Z.loadStatsForProjectSuccess(e.reduce(((e,t)=>e.concat(t)),[]))})).catch((()=>{(0,c.Iw)((0,u.t)("Unable to fetch all project stats"))})),p.clear()}),50);function g(e,t,o){p.add(t),h(e,p,o)}function f(e){i.Z.setActive(e)}function S(e,t,o){const s="/projects/".concat(t,"/").concat(o.slug,"/");return i.Z.removeProject(o),e.requestPromise(s,{method:"DELETE"}).then((()=>{i.Z.removeProjectSuccess(o),(0,c.S9)((0,u._N)("[project] was successfully removed",{project:o.slug}))}),(e=>{throw i.Z.removeProjectError(o),(0,c.Iw)((0,u._N)("Error removing [project]",{project:o.slug})),e}))}function j(e,t,o,s){const r="/projects/".concat(t,"/").concat(o.slug,"/transfer/");return e.requestPromise(r,{method:"POST",data:{email:s}}).then((()=>{(0,c.S9)((0,u._N)("A request was sent to move [project] to a different organization",{project:o.slug}))}),(e=>{let t="";var s;throw e.status>=400&&e.status<500&&e.responseJSON&&(t=null===(s=e.responseJSON)||void 0===s?void 0:s.detail),t?(0,c.Iw)((0,u._N)("Error transferring [project]. [message]",{project:o.slug,message:t})):(0,c.Iw)((0,u._N)("Error transferring [project]",{project:o.slug})),e}))}function v(e,t,o,s){const r="/projects/".concat(t,"/").concat(o,"/teams/").concat(s.slug,"/");return(0,c.E3)(),i.Z.addTeam(s),e.requestPromise(r,{method:"POST"}).then((e=>{(0,c.S9)((0,u._N)("[team] has been added to the [project] project",{team:"#".concat(s.slug),project:o})),i.Z.addTeamSuccess(s,o),i.Z.updateSuccess(e)}),(e=>{throw(0,c.Iw)((0,u._N)("Unable to add [team] to the [project] project",{team:"#".concat(s.slug),project:o})),i.Z.addTeamError(),e}))}function I(e,t,o,s){const r="/projects/".concat(t,"/").concat(o,"/teams/").concat(s,"/");return(0,c.E3)(),i.Z.removeTeam(s),e.requestPromise(r,{method:"DELETE"}).then((e=>{(0,c.S9)((0,u._N)("[team] has been removed from the [project] project",{team:"#".concat(s),project:o})),i.Z.removeTeamSuccess(s,o),i.Z.updateSuccess(e)}),(e=>{throw(0,c.Iw)((0,u._N)("Unable to remove [team] from the [project] project",{team:"#".concat(s),project:o})),i.Z.removeTeamError(e),e}))}function Z(e,t){i.Z.changeSlug(e,t)}function y(e,t,o,s,r,a={}){return e.requestPromise("/teams/".concat(t,"/").concat(o,"/projects/"),{method:"POST",data:{name:s,platform:r,default_rules:a.defaultRules}})}function x(e,t,o,s){return e.requestPromise("/projects/".concat(t,"/").concat(o,"/docs/").concat(s,"/"))}function E(e,t){return e.requestPromise("/organizations/".concat(t,"/projects-count/"))}async function T(e,t,o){return(await e.requestPromise("/organizations/".concat(t,"/releases/stats/"),{method:"GET",query:{statsPeriod:"90d",project:o,per_page:1}})).length>0}},"./app/actionCreators/teams.tsx":(e,t,o)=>{o.d(t,{PX:()=>u,eM:()=>d,z_:()=>l,fs:()=>m,um:()=>p,s:()=>h,Cm:()=>g,tT:()=>f}),o("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=o("./app/actionCreators/indicator.tsx"),r=o("./app/actions/teamActions.tsx"),a=o("./app/locale.tsx"),n=o("./app/utils/callIfFunction.tsx");if("app"==o.j)var c=o("./app/utils/guid.tsx");const i=(e={},t,...o)=>{(0,n.g)(e[t],...o)};async function u(e,t){const o=await e.requestPromise("/organizations/".concat(t.orgId,"/user-teams/"));r.Z.loadUserTeams(o)}function d(e,t,o){return r.Z.fetchDetails(t.teamId),e.request("/teams/".concat(t.orgId,"/").concat(t.teamId,"/"),{success:e=>{r.Z.fetchDetailsSuccess(t.teamId,e),i(o,"success",e)},error:e=>{r.Z.fetchDetailsError(t.teamId,e),i(o,"error",e)}})}function l(e,t){r.Z.updateSuccess(e,t)}function m(e,t,o){const s="/teams/".concat(t.orgId,"/").concat(t.teamId,"/");return r.Z.update(t.teamId,t.data),e.request(s,{method:"PUT",data:t.data,success:e=>{l(t.teamId,e),i(o,"success",e)},error:e=>{r.Z.updateError(t.teamId,e),i(o,"error",e)}})}function p(e,t,o){var s;const a="/organizations/".concat(t.orgId,"/members/").concat(null!==(s=t.memberId)&&void 0!==s?s:"me","/teams/").concat(t.teamId,"/"),n=(0,c.E)();return r.Z.update(n,t.teamId),e.request(a,{method:"POST",success:e=>{r.Z.updateSuccess(t.teamId,e),i(o,"success",e)},error:e=>{r.Z.updateError(n,t.teamId,e),i(o,"error",e)}})}function h(e,t,o){const s="/organizations/".concat(t.orgId,"/members/").concat(t.memberId||"me","/teams/").concat(t.teamId,"/"),a=(0,c.E)();return r.Z.update(a,t.teamId),e.request(s,{method:"DELETE",success:e=>{r.Z.updateSuccess(t.teamId,e),i(o,"success",e)},error:e=>{r.Z.updateError(a,t.teamId,e),i(o,"error",e)}})}function g(e,t,o){return r.Z.createTeam(t),e.requestPromise("/organizations/".concat(o.orgId,"/teams/"),{method:"POST",data:t}).then((e=>(r.Z.createTeamSuccess(e),(0,s.S9)((0,a._N)("[team] has been added to the [organization] organization",{team:"#".concat(e.slug),organization:o.orgId})),e)),(e=>{throw r.Z.createTeamError(t.slug,e),(0,s.Iw)((0,a._N)("Unable to create [team] in the [organization] organization",{team:"#".concat(t.slug),organization:o.orgId})),e}))}function f(e,t){return r.Z.removeTeam(t.teamId),e.requestPromise("/teams/".concat(t.orgId,"/").concat(t.teamId,"/"),{method:"DELETE"}).then((e=>(r.Z.removeTeamSuccess(t.teamId,e),(0,s.S9)((0,a._N)("[team] has been removed from the [organization] organization",{team:"#".concat(t.teamId),organization:t.orgId})),e)),(e=>{throw r.Z.removeTeamError(t.teamId,e),(0,s.Iw)((0,a._N)("Unable to remove [team] from the [organization] organization",{team:"#".concat(t.teamId),organization:t.orgId})),e}))}},"./app/stores/projectsStatsStore.tsx":(e,t,o)=>{o.d(t,{Z:()=>c}),o("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=o("../node_modules/reflux/src/index.js"),r=o.n(s),a=o("./app/actions/projectActions.tsx");const n={itemsBySlug:{},init(){this.reset(),this.listenTo(a.Z.loadStatsForProjectSuccess,this.onStatsLoadSuccess),this.listenTo(a.Z.update,this.onUpdate),this.listenTo(a.Z.updateError,this.onUpdateError)},getInitialState(){return this.itemsBySlug},reset(){this.itemsBySlug={},this.updatingItems=new Map},onStatsLoadSuccess(e){e.forEach((e=>{this.itemsBySlug[e.slug]=e})),this.trigger(this.itemsBySlug)},onUpdate(e,t){const o=this.getBySlug(e);if(this.updatingItems.set(e,o),!o)return;const s={...o,...t};this.itemsBySlug={...this.itemsBySlug,[o.slug]:s},this.trigger(this.itemsBySlug)},onUpdateSuccess(e){this.updatingItems.delete(e.slug)},onUpdateError(e,t){const o=this.updatingItems.get(t);o&&(this.updatingItems.delete(t),this.itemsBySlug={...this.itemsBySlug,[o.slug]:{...o}},this.trigger(this.itemsBySlug))},getAll(){return this.itemsBySlug},getBySlug(e){return this.itemsBySlug[e]}},c=r().createStore(n)},"./app/utils/isActiveSuperuser.tsx":(e,t,o)=>{o.d(t,{M:()=>n});var s=o("../node_modules/js-cookie/src/js.cookie.js"),r=o.n(s),a=o("./app/stores/configStore.tsx");function n(){const{isSuperuser:e}=a.Z.get("user")||{};return!(!e||(r().set("su","test"),void 0!==r().get("su")))}},"./app/utils/useTeams.tsx":(e,t,o)=>{o.d(t,{Z:()=>g}),o("../node_modules/core-js/modules/es.string.trim.js"),o("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=o("../node_modules/react/index.js"),r=o("../node_modules/lodash/uniqBy.js"),a=o.n(r),n=o("./app/actionCreators/teams.tsx"),c=o("./app/actions/teamActions.tsx"),i=o("./app/stores/organizationStore.tsx"),u=o("./app/stores/teamStore.tsx"),d=o("./app/stores/useLegacyStore.tsx"),l=o("./app/utils/isActiveSuperuser.tsx"),m=o("./app/utils/parseLinkHeader.tsx"),p=o("./app/utils/useApi.tsx");async function h(e,t,{slugs:o,ids:s,search:r,limit:a,lastSearch:n,cursor:c}={}){const i={};var u;void 0!==o&&o.length>0&&(i.query=o.map((e=>"slug:".concat(e))).join(" ")),void 0!==s&&s.length>0&&(i.query=s.map((e=>"id:".concat(e))).join(" ")),r&&(i.query="".concat(null!==(u=i.query)&&void 0!==u?u:""," ").concat(r).trim()),(n===r||!n&&!r)&&c&&(i.cursor=c),void 0!==a&&(i.per_page=a);let d=!1,l=null;const[p,,h]=await e.requestPromise("/organizations/".concat(t,"/teams/"),{includeAllArgs:!0,query:i}),g=null==h?void 0:h.getResponseHeader("Link");if(g){var f,S;const e=(0,m.Z)(g);d=null==e||null===(f=e.next)||void 0===f?void 0:f.results,l=null==e||null===(S=e.next)||void 0===S?void 0:S.cursor}return{results:p,hasMore:d,nextCursor:l}}const g=function({limit:e,slugs:t,ids:o,provideUserTeams:r}={}){var m,g;const f=(0,p.Z)(),{organization:S}=(0,d.X)(i.Z),j=(0,d.X)(u.Z),v=null==S?void 0:S.slug,I=new Set(j.teams.map((e=>e.slug))),Z=null!==(m=null==t?void 0:t.filter((e=>!I.has(e))))&&void 0!==m?m:[],y=new Set(j.teams.map((e=>e.id))),x=null!==(g=null==o?void 0:o.filter((e=>!y.has(e))))&&void 0!==g?g:[],E=Z.length>0,T=x.length>0,w=r&&!j.loadedUserTeams,_=!E&&!w&&!T,[q,P]=(0,s.useState)({initiallyLoaded:_,fetching:!1,hasMore:j.hasMore,lastSearch:null,nextCursor:j.cursor,fetchError:null}),z=(0,s.useRef)(null);if(void 0!==t||void 0!==o){var b;const e=null!==(b=t||o)&&void 0!==b?b:[];null===z.current&&(z.current=new Set(e)),(e.length!==z.current.size||e.some((e=>{var t;return!(null!==(t=z.current)&&void 0!==t&&t.has(e))})))&&(z.current=new Set(e))}async function M(t){const{lastSearch:o}=q,s=t?q.nextCursor:j.cursor;if(void 0!==v){P({...q,fetching:!0});try{f.clear();const{results:r,hasMore:n,nextCursor:i}=await h(f,v,{search:t,limit:e,lastSearch:o,cursor:s}),u=a()([...j.teams,...r],(({slug:e})=>e));t?u.length>j.teams.length&&c.Z.loadTeams(u):c.Z.loadTeams(u,n,i),P({...q,hasMore:n&&j.hasMore,fetching:!1,lastSearch:null!=t?t:null,nextCursor:i})}catch(e){console.error(e),P({...q,fetching:!1,fetchError:e})}}else console.error("Cannot fetch teams without an organization in context")}(0,s.useEffect)((()=>{E||T?async function(){if(void 0!==v){P({...q,fetching:!0});try{const{results:t,hasMore:o,nextCursor:s}=await h(f,v,{slugs:Z,ids:x,limit:e}),r=a()([...j.teams,...t],(({slug:e})=>e));c.Z.loadTeams(r),P({...q,hasMore:o,fetching:!1,initiallyLoaded:!0,nextCursor:s})}catch(e){console.error(e),P({...q,fetching:!1,initiallyLoaded:!0,fetchError:e})}}}():w&&async function(){if(void 0!==v){P({...q,fetching:!0});try{await(0,n.PX)(f,{orgId:v}),P({...q,fetching:!1,initiallyLoaded:!0})}catch(e){console.error(e),P({...q,fetching:!1,initiallyLoaded:!0,fetchError:e})}}}()}),[z.current,r]);const C=(0,l.M)();return{teams:t?j.teams.filter((e=>t.includes(e.slug))):o?j.teams.filter((e=>o.includes(e.id))):r&&!C?j.teams.filter((e=>e.isMember)):j.teams,fetching:q.fetching||j.loading,initiallyLoaded:q.initiallyLoaded,fetchError:q.fetchError,hasMore:q.hasMore,onSearch:async function(e){""!==e?M(e):q.hasMore===j.hasMore&&q.nextCursor===j.cursor||P({...q,lastSearch:e,hasMore:j.hasMore,nextCursor:j.cursor})},loadMore:M}}}}]);
//# sourceMappingURL=../sourcemaps/app_actionCreators_projects_tsx-app_utils_useTeams_tsx.a118955cc955e2abc8af1c8ce9f6e13e.js.map
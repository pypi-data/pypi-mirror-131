{% extends "chapters/base-wide.html" %}
{% load base_filters %}
{% load bootstrap_pagination_tags %}
{% load perm_tags %}
{% load profile_tags %}
{% load search_tags %}
{% load chapter_tags %}
{% load styled_forms %}

{% block title %}{% trans "Chapter Members Search" %}{% endblock %}

{% block extra_head %}
    {{ block.super }}

<style>
div.ex1 {
	max-height: 100vh;
	overflow-y: auto;
	/*position: sticky;*/
	top: 0;
}
#members-search-form .control-label {
	text-align: left!important;
	width: 100%;
	font-size: 1.1em;
}
h3{
	border-bottom: 1px solid #ccc; padding: 10px 0;
}
#members-wrap{
	overflow-x: auto;
}
.clearall, #export-btn{
	margin-left: 8px;
	white-space: nowrap;
}

</style>
{% endblock %}

{% block content %}
    <div class="t">
        <h1>{% trans "Chapter Members Search" %}</h1>

		<div class="row">
			<div class="col-sm-3 ex1">
				<h3>{% trans "Filter By" %}</h3>
				<i>{% trans "** Scroll down for more fields" %}</i>
				<form id="members-search-form" action="." method="get">
				<div id="profile-search-fields">
					<div class="form-group">
					    <div class="col-sm-offset-1">
					        <button type="submit" class="btn btn-success">
								<i class="glyphicon glyphicon-search" alt="Search Users"></i>
					            {% trans "Search" %}
					        </button>
							<a href="" class="clearall">{% trans "Clear All" %}</a>
							<button type="submit" name="export" id="export-btn" class="btn btn-xs btn-info">{% trans 'Export' %}</button>
					    </div>
					</div>
				
					{{ search_form|styled_form }}
				
					<div class="form-group">
					    <div class="col-sm-offset-1">
					        <button type="submit" class="btn btn-success">
								<i class="glyphicon glyphicon-search" alt="Search Users"></i>
					            {% trans "Search" %}
					        </button>
							<a href="" class="clearall">{% trans "Clear All" %}</a>
					    </div>
					</div>
				
				</div>
				</form>

			</div>
			<div class="col-sm-9">
				{% if chapter %}
				<h3>{% trans "Chapter:" %} <a href="{{ chapter.get_absolute_url }}">{{ chapter.title }}</a></h3>
				{% else %}
				<h3>{% trans "All Chapters" %}</h3>
				{% endif %}
				
				{% autopaginate chapter_memberships 20 %}

		        {% if chapter_memberships %}
		            <span><em>{{ paginator.count }} Member{{ paginator.count|pluralize }} {% trans "Found" %}</em></span>
		        {% else %}
		            <p>{% trans "0 chapter members found."%}</p>
		        {% endif %}


				{% if paginator.count > 0  %}
				<div id="members-wrap">
				<table class="table table-striped table-bordered">
					<tr>
					<th>{% trans "View" %}</th>
					<th>{% trans "Edit" %}</th>
					{% if not chapter %}
					<th>{% trans "Chapter" %}</th>
					{% endif %}
					<th>{% trans "User" %}</th>
					<th nowrap>{% trans "Membership Type" %}</th>
					<th nowrap>{% trans "Balance Due" %}</th>
					{% for app_field in app_fields %}
						<th nowrap>{{ app_field.label }}</th>
					{% endfor %}
					<th nowrap>{% trans "Create Date" %}</th>
					<th nowrap>{% trans "Join Date" %}</th>
					<th nowrap>{% trans "Renew Date" %}</th>
					<th nowrap>{% trans "Expire Date" %}</th>
					<th nowrap>{% trans "Status Detail" %}</th>
					</tr>
			
					{% for chapter_membership in chapter_memberships %}
					<tr>
						<td><a href="{% url "chapters.membership_details" chapter_membership.id  %}"><img src="{% static 'images/icons/external_16x16.png' %}" alt="View chapter membership: {{ chapter_membership }}"></a></td>
						<td><a href="{% url "chapters.membership_edit" chapter_membership.id  %}">{% trans "Edit" %}</a></td>
						{% if not chapter %}
						<td><a href="{% url 'chapters.detail' chapter_membership.chapter.slug %}">{{ chapter_membership.chapter.title }}</a></td>
						{% endif %}
						<td nowrap>{{ chapter_membership.user.get_full_name }}</td>
						<td nowrap>{{ chapter_membership.membership_type.name }}</td>
						<td nowrap>
						{% if chapter_membership.invoice %}
                        <a href="{% url "invoice.view" chapter_membership.invoice.pk %}">{{ chapter_membership.invoice.balance|format_currency }}</a>
                    	{% endif %}
						</td>
						{% render_chapter_member_row chapter_membership app_fields %}
						<td nowrap>{{ chapter_membership.create_dt|date:"N j, Y" }}</td>
						<td nowrap>{{ chapter_membership.join_dt|date:"N j, Y" }}</td>
						<td nowrap>{% if chapter_membership.renew_dt %}{{ chapter_membership.renew_dt|date:"N j, Y" }}{% endif %}</td>
						<td nowrap>{% if chapter_membership.expire_dt %}{{ chapter_membership.expire_dt|date:"N j, Y" }}{% endif %}</td>
						<td nowrap>{{ chapter_membership.status_detail }}</td>
					</tr>
					{% endfor %}
				</table>
				</div>
				<i>{% trans "** Scroll left to view more columns" %}</i>
				{% endif %}

		
		        {% paginate %}
						
			</div>
		</div>

    </div>
{% endblock %}

{% block extra_body %}
{{ block.super }}
<script type="text/javascript">
	$(".clearall").on("click", function(event) {
		event.preventDefault();
	    $("#members-search-form")[0].reset();
		$("#members-search-form input[type='text']").val('');
		$("#members-search-form input[type='checkbox']:checked").prop('checked', false);
		$("#members-search-form select option:selected").prop('selected', false);
	});
</script>
{% endblock %}
